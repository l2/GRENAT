<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of GRENAT</title>
  <meta name="keywords" content="GRENAT">
  <meta name="description" content="% GRENAT class for manipulating gradient-enhanced metamodels">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html GRENAT -->
<h1>GRENAT
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>% GRENAT class for manipulating gradient-enhanced metamodels</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">% GRENAT class for manipulating gradient-enhanced metamodels
 L. LAURENT -- 26/06/2016 -- luc.laurent@lecnam.net</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="GRENAT.html" class="code" title="">GRENAT</a>	% GRENAT class for manipulating gradient-enhanced metamodels</li><li><a href="initDirGRENAT.html" class="code" title="function foldersLoad=initDirGRENAT(pathcustom,other,flagNested)">initDirGRENAT</a>	% Initialization of the directories (MATLAB's path)</li><li><a href="../GRENAT/src/crit/BuildCI.html" class="code" title="function [ci68,ci95,ci99]=BuildCI(ZZ,var)">BuildCI</a>	% function for building confidence intervals (CI)</li><li><a href="../GRENAT/src/crit/InfillCrit.html" class="code" title="function [ZI,detInfill]=InfillCrit(respMin,Z,varZ,infillData)">InfillCrit</a>	% Compute infill criteria EI/WEI/LCB</li><li><a href="../GRENAT/src/crit/critErrDisp.html" class="code" title="function [err,errV,errNAME]=critErrDisp(Zap,Zref,data)">critErrDisp</a>	% Compute error criteria and display</li><li><a href="../GRENAT/src/disp/dispDate.html" class="code" title="function dispDate(type)">dispDate</a>	% Display date and time</li><li><a href="../GRENAT/src/disp/displaySurrogate.html" class="code" title="function figHandle=displaySurrogate(gridXY,Z,sampling,resp,grad,dispData)">displaySurrogate</a>	% function for displaying response surfaces</li><li><a href="../GRENAT/src/disp/displaySurrogateCI.html" class="code" title="function displaySurrogateCI(Xpts,ic,dispData,Z)">displaySurrogateCI</a>	% Display confidence intervals</li><li><a href="../GRENAT/src/init/initDisp.html" class="code" title="">initDisp</a>	% Initialization of display variables</li><li><a href="../GRENAT/src/init/initMeta.html" class="code" title="">initMeta</a>	% Initialization of the surrogate model</li><li><a href="../GRENAT/src/surrogate/BuildMeta.html" class="code" title="function [outMeta]=BuildMeta(samplingIn,respIn,gradIn,metaData)">BuildMeta</a>	% function for building surrogate model</li><li><a href="../GRENAT/src/surrogate/EvalMeta.html" class="code" title="function [Z]=EvalMeta(evalSample,dataTrain,metaConf,Verb)">EvalMeta</a>	% Evaluation of the surrogate model</li><li><a href="../GRENAT/src/various/CheckInputData.html" class="code" title="function [ret]=CheckInputData(sampling,resp,grad)">CheckInputData</a>	% check input data for finding missing information</li><li><a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>	% Normalization and renormalization of the Data</li><li><a href="../GRENAT/src/various/NormRenormG.html" class="code" title="function [out]=NormRenormG(in,type,infoDataS,infoDataR)">NormRenormG</a>	% normalization and renormalization of the gradient data</li><li><a href="../GRENAT/src/various/checkInterpRG.html" class="code" title="function statusI=checkInterpRG(ZRef,ZApp,type,critR,critG)">checkInterpRG</a>	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="ExampleUse1D.html" class="code" title="">ExampleUse1D</a>	Example of use of GRENAT without the sampling toolbox</li><li><a href="ExampleUse2D.html" class="code" title="">ExampleUse2D</a>	% Example of use of GRENAT without the sampling toolbox</li><li><a href="ExampleUseDOE.html" class="code" title="">ExampleUseDOE</a>	% Example of use of the GRENAToolbox with the MultiDOE one</li><li><a href="GRENAT.html" class="code" title="">GRENAT</a>	% GRENAT class for manipulating gradient-enhanced metamodels</li><li><a href="README.html" class="code" title="">README</a>	</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj=GRENAT(typeIn,samplingIn,respIn,gradIn)</a></li><li><a href="#_sub2" class="code">function set.sampling(obj,samplingIn)</a></li><li><a href="#_sub3" class="code">function set.resp(obj,respIn)</a></li><li><a href="#_sub4" class="code">function set.grad(obj,gradIn)</a></li><li><a href="#_sub5" class="code">function set.nonsamplePts(obj,samplingIn)</a></li><li><a href="#_sub6" class="code">function set.type(obj,typeIn)</a></li><li><a href="#_sub7" class="code">function type=get.type(obj)</a></li><li><a href="#_sub8" class="code">function PtS=get.nonsamplePtsOrder(obj)</a></li><li><a href="#_sub9" class="code">function Z=get.nonsampleResp(obj)</a></li><li><a href="#_sub10" class="code">function GZ=get.nonsampleGrad(obj)</a></li><li><a href="#_sub11" class="code">function variance=get.nonsampleVar(obj)</a></li><li><a href="#_sub12" class="code">function err=get.err(obj)</a></li><li><a href="#_sub13" class="code">function normStruct=get.norm(obj)</a></li><li><a href="#_sub14" class="code">function initRunTrain(obj,flag)</a></li><li><a href="#_sub15" class="code">function initGradAvail(obj,flag)</a></li><li><a href="#_sub16" class="code">function initRunEval(obj,flag)</a></li><li><a href="#_sub17" class="code">function initData(obj)</a></li><li><a href="#_sub18" class="code">function dataOut=orderData(obj,dataIn,type)</a></li><li><a href="#_sub19" class="code">function dataOut=normInputData(obj,type,dataIn)</a></li><li><a href="#_sub20" class="code">function dataOut=reNormInputData(obj,type,dataIn)</a></li><li><a href="#_sub21" class="code">function resetNorm(obj)</a></li><li><a href="#_sub22" class="code">function checkMissingData(obj)</a></li><li><a href="#_sub23" class="code">function defineDisp(obj,varargin)</a></li><li><a href="#_sub24" class="code">function train(obj)</a></li><li><a href="#_sub25" class="code">function update(samplingIn,respIn,gradIn,paraFind,varargin)</a></li><li><a href="#_sub26" class="code">function [Z,GZ,variance]=eval(obj,nonsamplePts)</a></li><li><a href="#_sub27" class="code">function [ZI,detI]=evalInfill(obj,nonsamplePts)</a></li><li><a href="#_sub28" class="code">function [statusR,statusG]=checkInterp(obj)</a></li><li><a href="#_sub29" class="code">function [ci68,ci95,ci99]=evalCI(obj,nonsamplePts)</a></li><li><a href="#_sub30" class="code">function [ci68,ci95,ci99]=CI(obj,nonsamplePts)</a></li><li><a href="#_sub31" class="code">function errCalc(obj)</a></li><li><a href="#_sub32" class="code">function defineRef(obj,varargin)</a></li><li><a href="#_sub33" class="code">function [okAll,okSample,okResp,okGrad]=checkRef(obj)</a></li><li><a href="#_sub34" class="code">function conf(obj,varargin)</a></li><li><a href="#_sub35" class="code">function show(obj,varargin)</a></li><li><a href="#_sub36" class="code">function show1D(obj)</a></li><li><a href="#_sub37" class="code">function show2D(obj)</a></li><li><a href="#_sub38" class="code">function showRespRef(obj)</a></li><li><a href="#_sub39" class="code">function showGradRef(obj,nbG)</a></li><li><a href="#_sub40" class="code">function showResp(obj)</a></li><li><a href="#_sub41" class="code">function showGrad(obj,nbG)</a></li><li><a href="#_sub42" class="code">function showCI(obj,ciVal,nonsamplePts)</a></li><li><a href="#_sub43" class="code">function isF=isfield(obj,field)</a></li><li><a href="#_sub44" class="code">function info=affectTxtProp()</a></li><li><a href="#_sub45" class="code">function dispTableTwoColumnsStruct(tableFiedIn,structIn)</a></li><li><a href="#_sub46" class="code">function dispTableTwoColumns(tableA,tableB)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% GRENAT class for manipulating gradient-enhanced metamodels</span>
0002 <span class="comment">% L. LAURENT -- 26/06/2016 -- luc.laurent@lecnam.net</span>
0003 
0004 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0005 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0006 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0009 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0010 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0011 <span class="comment">%     (at your option) any later version.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0014 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0015 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0016 <span class="comment">%     GNU General Public License for more details.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0019 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0020 
0021 classdef <a href="GRENAT.html" class="code" title="">GRENAT</a> &lt; handle
0022     
0023     properties
0024         <span class="comment">%building</span>
0025         sampling=[];
0026         resp=[];
0027         grad=[];
0028         samplingN=[];
0029         respN=[];
0030         gradN=[];
0031         <span class="comment">%evaluating</span>
0032         nonsamplePts=[];
0033         nonsampleResp=[];
0034         nonsampleGrad=[];
0035         nonsamplePtsOrder=[];
0036         nonsampleRespOrder=[];
0037         nonsampleGradOrder=[];
0038         nonsamplePtsN=[];
0039         nonsampleRespN=[];
0040         nonsampleGradN=[];
0041         sizeNonSample=zeros(1,3);
0042         nonsampleVar=[];
0043         nonsampleVarOrder=[];
0044         nonsampleCI=struct(<span class="string">'ci68'</span>,[],<span class="string">'ci95'</span>,[],<span class="string">'ci98'</span>,[]);
0045         nonsampleEI=[];
0046         <span class="comment">%normalization data</span>
0047         norm;
0048         normMeanS;
0049         normStdS;
0050         normMeanR;
0051         normStdR;
0052         <span class="comment">%</span>
0053         err=[];
0054         <span class="comment">%reference</span>
0055         sampleRef=[];
0056         respRef=[];
0057         gradRef=[];
0058         <span class="comment">%structures &amp; class for storing configuration and data</span>
0059         confMeta;   <span class="comment">%metamodel configuration</span>
0060         dataTrain;  <span class="comment">%training data</span>
0061         confDisp;   <span class="comment">%display configuration</span>
0062         miss;       <span class="comment">%missing data</span>
0063     <span class="keyword">end</span>
0064     properties (Dependent)
0065         type;
0066     <span class="keyword">end</span>
0067     
0068     properties (Access = private)
0069         runTrain=true; <span class="comment">%flag for checking if the training is obsolete</span>
0070         runEval=true; <span class="comment">%flag for checking if the training is obsolete</span>
0071         gradAvail=false; <span class="comment">%flag for availability of the gradients</span>
0072         runErr=true; <span class="comment">%flag for computation of the error</span>
0073         normSamplePtsIn=false; <span class="comment">%flag for checking if the input data are normalized</span>
0074         normRespIn=false; <span class="comment">%flag for checking if the input data are normalized</span>
0075         runMissingData=true; <span class="comment">%flag for checking missing data</span>
0076         nbSubplot=0; <span class="comment">%number of subplot for display</span>
0077     <span class="keyword">end</span>
0078     properties (Access = private,Constant)
0079         infoProp=<a href="#_sub44" class="code" title="subfunction info=affectTxtProp()">affectTxtProp</a>;
0080     <span class="keyword">end</span>
0081     
0082     methods
0083         <span class="comment">%construction</span>
0084         <a name="_sub0" href="#_subfunctions" class="code">function obj=GRENAT(typeIn,samplingIn,respIn,gradIn)</a>
0085             <span class="comment">%load directories on the path</span>
0086             <a href="initDirGRENAT.html" class="code" title="function foldersLoad=initDirGRENAT(pathcustom,other,flagNested)">initDirGRENAT</a>;
0087             <span class="comment">%</span>
0088             fprintf(<span class="string">'=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=\n'</span>);
0089             fprintf(<span class="string">'=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=\n'</span>);
0090             fprintf(<span class="string">' Create GRENAT Object \n'</span>)
0091             <span class="comment">%the date and time</span>
0092             <a href="../GRENAT/src/disp/dispDate.html" class="code" title="function dispDate(type)">dispDate</a>;
0093             <span class="comment">%load default configuration</span>
0094             obj.confMeta=<a href="../GRENAT/src/init/initMeta.html" class="code" title="">initMeta</a>;
0095             <span class="comment">%load display configuration</span>
0096             obj.confDisp=<a href="../GRENAT/src/init/initDisp.html" class="code" title="">initDisp</a>;
0097             <span class="comment">%specific configuration</span>
0098             <span class="keyword">if</span> nargin&gt;0;obj.confMeta.type=typeIn;<span class="keyword">end</span>
0099             <span class="keyword">if</span> nargin&gt;1;obj.sampling=samplingIn;<span class="keyword">end</span>
0100             <span class="keyword">if</span> nargin&gt;2;obj.resp=respIn;<span class="keyword">end</span>
0101             <span class="keyword">if</span> nargin&gt;3;obj.grad=gradIn;<span class="keyword">end</span>
0102         <span class="keyword">end</span>
0103         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0104         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0105         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0106         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0107         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0108         <span class="comment">%setter for the sampling</span>
0109         <a name="_sub1" href="#_subfunctions" class="code">function set.sampling(obj,samplingIn)</a>
0110             <span class="keyword">if</span> ~isempty(samplingIn)
0111                 <span class="keyword">if</span> isempty(obj.sampling)
0112                     obj.sampling=samplingIn;
0113                 <span class="keyword">else</span>
0114                     obj.sampling=[obj.sampling;samplingIn];
0115                 <span class="keyword">end</span>
0116                 <a href="#_sub14" class="code" title="subfunction initRunTrain(obj,flag)">initRunTrain</a>(obj,true);
0117                 <a href="#_sub21" class="code" title="subfunction resetNorm(obj)">resetNorm</a>(obj);
0118             <span class="keyword">else</span>
0119                 fprintf(<span class="string">'ERROR: Empty array of sample points\n'</span>);
0120             <span class="keyword">end</span>
0121         <span class="keyword">end</span>
0122         <span class="comment">%setter for the responses</span>
0123         <a name="_sub2" href="#_subfunctions" class="code">function set.resp(obj,respIn)</a>
0124             <span class="keyword">if</span> ~isempty(respIn)
0125                 <span class="keyword">if</span> isempty(obj.resp)
0126                     obj.resp=respIn;
0127                 <span class="keyword">else</span>
0128                     obj.resp=[obj.resp;respIn];
0129                 <span class="keyword">end</span>
0130                 <a href="#_sub14" class="code" title="subfunction initRunTrain(obj,flag)">initRunTrain</a>(obj,true);
0131             <span class="keyword">else</span>
0132                 fprintf(<span class="string">'ERROR: Empty array of responses\n'</span>);
0133             <span class="keyword">end</span>
0134         <span class="keyword">end</span>
0135         <span class="comment">%setter for the gradients</span>
0136         <a name="_sub3" href="#_subfunctions" class="code">function set.grad(obj,gradIn)</a>
0137             <span class="keyword">if</span> ~isempty(gradIn)
0138                 <span class="keyword">if</span> isempty(obj.grad)
0139                     obj.grad=gradIn;
0140                 <span class="keyword">else</span>
0141                     obj.grad=[obj.grad;gradIn];
0142                 <span class="keyword">end</span>
0143                 <a href="#_sub14" class="code" title="subfunction initRunTrain(obj,flag)">initRunTrain</a>(obj,true);
0144                 <a href="#_sub15" class="code" title="subfunction initGradAvail(obj,flag)">initGradAvail</a>(obj,true);
0145             <span class="keyword">end</span>
0146         <span class="keyword">end</span>
0147         <span class="comment">%setter for the non sample points</span>
0148         <a name="_sub4" href="#_subfunctions" class="code">function set.nonsamplePts(obj,samplingIn)</a>
0149             <span class="keyword">if</span> ~isempty(samplingIn)
0150                 obj.nonsamplePts=samplingIn;
0151                 <a href="#_sub16" class="code" title="subfunction initRunEval(obj,flag)">initRunEval</a>(obj,true);
0152             <span class="keyword">end</span>
0153         <span class="keyword">end</span>
0154         <span class="comment">%setter for the type of metamodel</span>
0155         <a name="_sub5" href="#_subfunctions" class="code">function set.type(obj,typeIn)</a>
0156             obj.confMeta.type=typeIn;
0157         <span class="keyword">end</span>
0158         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0159         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0160         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0161         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0162         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0163         <span class="comment">%getter for the type of metamodel</span>
0164         <a name="_sub6" href="#_subfunctions" class="code">function type=get.type(obj)</a>
0165             type=obj.confMeta.type;
0166         <span class="keyword">end</span>
0167         <span class="comment">%setter for the non sample points</span>
0168         <a name="_sub7" href="#_subfunctions" class="code">function PtS=get.nonsamplePtsOrder(obj)</a>
0169             PtS=<a href="#_sub18" class="code" title="subfunction dataOut=orderData(obj,dataIn,type)">orderData</a>(obj,obj.nonsamplePts,<span class="string">'sampleIn'</span>);
0170         <span class="keyword">end</span>
0171         <span class="comment">%getter for the responses at the non sample points</span>
0172         <a name="_sub8" href="#_subfunctions" class="code">function Z=get.nonsampleResp(obj)</a>
0173             <span class="keyword">if</span> obj.runEval;<a href="#_sub26" class="code" title="subfunction [Z,GZ,variance]=eval(obj,nonsamplePts)">eval</a>(obj);<span class="keyword">end</span>
0174             Z=<a href="#_sub18" class="code" title="subfunction dataOut=orderData(obj,dataIn,type)">orderData</a>(obj,obj.nonsampleRespOrder,<span class="string">'respOut'</span>);
0175         <span class="keyword">end</span>
0176         <span class="comment">%getter for the gradients at the non sample points</span>
0177         <a name="_sub9" href="#_subfunctions" class="code">function GZ=get.nonsampleGrad(obj)</a>
0178             <span class="keyword">if</span> obj.runEval;<a href="#_sub26" class="code" title="subfunction [Z,GZ,variance]=eval(obj,nonsamplePts)">eval</a>(obj);<span class="keyword">end</span>
0179             GZ=<a href="#_sub18" class="code" title="subfunction dataOut=orderData(obj,dataIn,type)">orderData</a>(obj,obj.nonsampleGradOrder,<span class="string">'gradOut'</span>);
0180         <span class="keyword">end</span>
0181         <span class="comment">%getter for the variance at the non sample points</span>
0182         <a name="_sub10" href="#_subfunctions" class="code">function variance=get.nonsampleVar(obj)</a>
0183             <span class="keyword">if</span> obj.runEval;<a href="#_sub26" class="code" title="subfunction [Z,GZ,variance]=eval(obj,nonsamplePts)">eval</a>(obj);<span class="keyword">end</span>
0184             variance=<a href="#_sub18" class="code" title="subfunction dataOut=orderData(obj,dataIn,type)">orderData</a>(obj,obj.nonsampleVarOrder,<span class="string">'respOut'</span>);
0185         <span class="keyword">end</span>
0186         <span class="comment">%getter for error values</span>
0187         <a name="_sub11" href="#_subfunctions" class="code">function err=get.err(obj)</a>
0188             <span class="keyword">if</span> obj.runErr;<a href="#_sub31" class="code" title="subfunction errCalc(obj)">errCalc</a>(obj);<span class="keyword">end</span>
0189             err=obj.err;
0190         <span class="keyword">end</span>
0191         <span class="comment">%getter for normalization data structure</span>
0192         <a name="_sub12" href="#_subfunctions" class="code">function normStruct=get.norm(obj)</a>
0193             normStruct.sampling.mean=obj.normMeanS;
0194             normStruct.sampling.std=obj.normStdS;
0195             normStruct.resp.mean=obj.normMeanR;
0196             normStruct.resp.std=obj.normStdR;
0197             normStruct.on=obj.confMeta.normOn;
0198         <span class="keyword">end</span>
0199         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0200         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0201         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0202         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0203         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0204         <span class="comment">%initialize flags</span>
0205         <a name="_sub13" href="#_subfunctions" class="code">function initRunTrain(obj,flag)</a>
0206             obj.runTrain=flag;
0207         <span class="keyword">end</span>
0208         <a name="_sub14" href="#_subfunctions" class="code">function initGradAvail(obj,flag)</a>
0209             obj.gradAvail=flag;
0210         <span class="keyword">end</span>
0211         <a name="_sub15" href="#_subfunctions" class="code">function initRunEval(obj,flag)</a>
0212             obj.runEval=flag;
0213         <span class="keyword">end</span>
0214         <span class="comment">%initialize data (remove saved data)</span>
0215         <a name="_sub16" href="#_subfunctions" class="code">function initData(obj)</a>
0216             obj.sampling=[];
0217             obj.resp=[];
0218             obj.grad=[];
0219         <span class="keyword">end</span>
0220         <span class="comment">%ordering data (for manipulating nd-arrays)</span>
0221         <a name="_sub17" href="#_subfunctions" class="code">function dataOut=orderData(obj,dataIn,type)</a>
0222             <span class="keyword">switch</span> type
0223                 <span class="keyword">case</span> <span class="string">'sampleIn'</span>
0224                     <span class="comment">%size of the input data</span>
0225                     obj.sizeNonSample=[size(dataIn,1),size(dataIn,2),size(dataIn,3)];
0226                     <span class="comment">%in the case of nd-array</span>
0227                     <span class="keyword">if</span> obj.sizeNonSample(3)&gt;1
0228                         dataOut=reshape(dataIn,[ obj.sizeNonSample(1)*obj.sizeNonSample(2),obj.sizeNonSample(3),1]);
0229                     <span class="keyword">else</span>
0230                         dataOut=dataIn;
0231                     <span class="keyword">end</span>
0232                 <span class="keyword">case</span> <span class="string">'sampleOut'</span>
0233                     <span class="keyword">if</span> obj.sizeNonSample(3)&gt;1
0234                         dataOut=reshape(dataIn,[ obj.sizeNonSample(1),obj.sizeNonSample(2),obj.sizeNonSample(3)]);
0235                     <span class="keyword">else</span>
0236                         dataOut=dataIn;
0237                     <span class="keyword">end</span>
0238                 <span class="keyword">case</span> <span class="string">'respOut'</span>
0239                     <span class="keyword">if</span> obj.sizeNonSample(3)&gt;1
0240                         dataOut=reshape(dataIn,[ obj.sizeNonSample(1),obj.sizeNonSample(2)]);
0241                     <span class="keyword">else</span>
0242                         dataOut=dataIn;
0243                     <span class="keyword">end</span>
0244                 <span class="keyword">case</span> <span class="string">'gradOut'</span>
0245                     <span class="keyword">if</span> obj.sizeNonSample(3)&gt;1
0246                         dataOut=reshape(dataIn,[ obj.sizeNonSample(1),obj.sizeNonSample(2),obj.sizeNonSample(3)]);
0247                     <span class="keyword">else</span>
0248                         dataOut=dataIn;
0249                     <span class="keyword">end</span>
0250             <span class="keyword">end</span>
0251         <span class="keyword">end</span>
0252         <span class="comment">%Normalization of the input data</span>
0253         <a name="_sub18" href="#_subfunctions" class="code">function dataOut=normInputData(obj,type,dataIn)</a>
0254             <span class="keyword">if</span> obj.confMeta.normOn
0255                 <span class="comment">%preparing data structures</span>
0256                 infoDataS=obj.norm.sampling;
0257                 infoDataR=obj.norm.resp;
0258                 <span class="comment">%for various situations</span>
0259                 <span class="keyword">switch</span> type
0260                     <span class="keyword">case</span> <span class="string">'initSamplePts'</span>
0261                         [obj.samplingN,infoDataS]=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(obj.sampling,<span class="string">'norm'</span>);
0262                         obj.normMeanS=infoDataS.mean;
0263                         obj.normStdS=infoDataS.std;
0264                         obj.normSamplePtsIn=true;
0265                     <span class="keyword">case</span> <span class="string">'initResp'</span>
0266                         [obj.respN,infoDataR]=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(obj.resp,<span class="string">'norm'</span>);
0267                         obj.normMeanR=infoDataR.mean;
0268                         obj.normStdR=infoDataR.std;
0269                         obj.normRespIn=true;
0270                     <span class="keyword">case</span> <span class="string">'SamplePts'</span>
0271                         dataOut=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(dataIn,<span class="string">'norm'</span>,infoDataS);
0272                     <span class="keyword">case</span> <span class="string">'Resp'</span>
0273                         dataOut=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(dataIn,<span class="string">'norm'</span>,infoDataR);
0274                     <span class="keyword">case</span> <span class="string">'Grad'</span>
0275                         <span class="keyword">if</span> ~isempty(dataIn)
0276                             dataOut=<a href="../GRENAT/src/various/NormRenormG.html" class="code" title="function [out]=NormRenormG(in,type,infoDataS,infoDataR)">NormRenormG</a>(dataIn,<span class="string">'norm'</span>,infoDataS,infoDataR);
0277                         <span class="keyword">else</span>
0278                             dataOut=[];
0279                         <span class="keyword">end</span>
0280                 <span class="keyword">end</span>
0281             <span class="keyword">else</span>
0282                 <span class="keyword">if</span> nargout&gt;2
0283                     dataOut=dataIn;
0284                 <span class="keyword">end</span>
0285             <span class="keyword">end</span>
0286         <span class="keyword">end</span>
0287         <span class="comment">%ReNormalization of the input data</span>
0288         <a name="_sub19" href="#_subfunctions" class="code">function dataOut=reNormInputData(obj,type,dataIn)</a>
0289             <span class="keyword">if</span> obj.confMeta.normOn
0290                 <span class="comment">%preparing data structures</span>
0291                 infoDataS=obj.norm.sampling;
0292                 infoDataR=obj.norm.resp;
0293                 <span class="comment">%for various situations</span>
0294                 <span class="keyword">switch</span> type
0295                     <span class="keyword">case</span> <span class="string">'SamplePts'</span>
0296                         dataOut=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(dataIn,<span class="string">'renorm'</span>,infoDataS);
0297                     <span class="keyword">case</span> <span class="string">'Resp'</span>
0298                         dataOut=<a href="../GRENAT/src/various/NormRenorm.html" class="code" title="function [out,infoData]=NormRenorm(in,type,infoData)">NormRenorm</a>(dataIn,<span class="string">'renorm'</span>,infoDataR);
0299                     <span class="keyword">case</span> <span class="string">'Grad'</span>
0300                         dataOut=<a href="../GRENAT/src/various/NormRenormG.html" class="code" title="function [out]=NormRenormG(in,type,infoDataS,infoDataR)">NormRenormG</a>(dataIn,<span class="string">'renorm'</span>,infoDataS,infoDataR);
0301                 <span class="keyword">end</span>
0302             <span class="keyword">else</span>
0303                 <span class="keyword">if</span> nargout&gt;2
0304                     dataOut=dataIn;
0305                 <span class="keyword">end</span>
0306             <span class="keyword">end</span>
0307         <span class="keyword">end</span>
0308         <span class="comment">%reset normalisation state</span>
0309         <a name="_sub20" href="#_subfunctions" class="code">function resetNorm(obj)</a>
0310             obj.normSamplePtsIn=false;
0311             obj.normRespIn=false;
0312         <span class="keyword">end</span>
0313         <span class="comment">%check missing data</span>
0314         <a name="_sub21" href="#_subfunctions" class="code">function checkMissingData(obj)</a>
0315             <span class="comment">%Check input data (find missing data)</span>
0316             obj.confMeta.miss=<a href="../GRENAT/src/various/CheckInputData.html" class="code" title="function [ret]=CheckInputData(sampling,resp,grad)">CheckInputData</a>(obj.samplingN,obj.respN,obj.gradN);
0317             obj.runMissingData=false;
0318         <span class="keyword">end</span>
0319         <span class="comment">%define the configuration for the display</span>
0320         <a name="_sub22" href="#_subfunctions" class="code">function defineDisp(obj,varargin)</a>
0321             <span class="comment">% look up the previous value</span>
0322             obj.confDisp.conf(varargin{:});
0323         <span class="keyword">end</span>
0324         <span class="comment">%train the metamodel</span>
0325         <a name="_sub23" href="#_subfunctions" class="code">function train(obj)</a>
0326             <span class="comment">%normalization of the input data</span>
0327             <a href="#_sub19" class="code" title="subfunction dataOut=normInputData(obj,type,dataIn)">normInputData</a>(obj,<span class="string">'initSamplePts'</span>);
0328             <a href="#_sub19" class="code" title="subfunction dataOut=normInputData(obj,type,dataIn)">normInputData</a>(obj,<span class="string">'initResp'</span>);
0329             obj.gradN=<a href="#_sub19" class="code" title="subfunction dataOut=normInputData(obj,type,dataIn)">normInputData</a>(obj,<span class="string">'Grad'</span>,obj.grad);
0330             <span class="comment">%check if data are missing</span>
0331             <a href="#_sub22" class="code" title="subfunction checkMissingData(obj)">checkMissingData</a>(obj);
0332             <span class="comment">%store normalization data</span>
0333             obj.confMeta.norm=obj.norm;
0334             <span class="comment">%train surrogate model</span>
0335             obj.dataTrain=<a href="../GRENAT/src/surrogate/BuildMeta.html" class="code" title="function [outMeta]=BuildMeta(samplingIn,respIn,gradIn,metaData)">BuildMeta</a>(obj.samplingN,obj.respN,obj.gradN,obj.confMeta);
0336             obj.runTrain=false;
0337             obj.runErr=true;
0338             
0339             <span class="comment">% keyboard</span>
0340             <span class="comment">% if metaData.norm.on&amp;&amp;~isempty(metaData.norm.resp.std)</span>
0341             <span class="comment">%     ret.build.sig2=ret.build.sig2*metaData.norm.resp.std^2;</span>
0342             <span class="comment">% end</span>
0343         <span class="keyword">end</span>
0344         <span class="comment">%update the metamodel by adding sample points and associated</span>
0345         <span class="comment">%responses and gradients</span>
0346         <a name="_sub24" href="#_subfunctions" class="code">function update(samplingIn,respIn,gradIn,paraFind,varargin)</a>
0347             <span class="comment">%add data</span>
0348             <span class="keyword">if</span> ~isempty(samplingIn)
0349                 obj.sampling=samplingIn;
0350                 obj.resp=respIn;
0351                 obj.grad=gradIn;
0352                 <span class="comment">%initialize flags</span>
0353                 <a href="#_sub14" class="code" title="subfunction initRunTrain(obj,flag)">initRunTrain</a>(obj,true);
0354                 <a href="#_sub16" class="code" title="subfunction initRunEval(obj,flag)">initRunEval</a>(obj,true);
0355                 <span class="comment">%change status of the estimation of the parameters</span>
0356                 obj.confMeta.conf(<span class="string">'estimOn'</span>,paraFind);
0357                 <span class="comment">%deal with additional options</span>
0358                 <span class="keyword">if</span> nargin&gt;4;
0359                     obj.confMeta.conf(varargin{:});
0360                 <span class="keyword">end</span>
0361             <span class="keyword">end</span>
0362         <span class="keyword">end</span>
0363         <span class="comment">%evaluate the metamodel</span>
0364         <a name="_sub25" href="#_subfunctions" class="code">function [Z,GZ,variance]=eval(obj,nonsamplePts)</a>
0365             <span class="comment">%check if the metamodel has been already trained</span>
0366             <span class="keyword">if</span> obj.runTrain;<a href="#_sub24" class="code" title="subfunction train(obj)">train</a>(obj);<span class="keyword">end</span>
0367             <span class="comment">%store non sample points</span>
0368             <span class="keyword">if</span> nargin&gt;1;obj.nonsamplePts=nonsamplePts;<span class="keyword">end</span>
0369             <span class="comment">%evaluation of the metamodels</span>
0370             <span class="keyword">if</span> obj.runEval
0371                 <span class="comment">%normalization of the input data</span>
0372                 obj.nonsamplePtsN=<a href="#_sub19" class="code" title="subfunction dataOut=normInputData(obj,type,dataIn)">normInputData</a>(obj,<span class="string">'SamplePts'</span>,obj.nonsamplePtsOrder);
0373                 <span class="comment">%evaluation of the metamodel</span>
0374                 [K]=<a href="../GRENAT/src/surrogate/EvalMeta.html" class="code" title="function [Z]=EvalMeta(evalSample,dataTrain,metaConf,Verb)">EvalMeta</a>(obj.nonsamplePtsN,obj.dataTrain,obj.confMeta);
0375                 <span class="comment">%store data from the evaluation</span>
0376                 obj.nonsampleRespN=K.Z;
0377                 obj.nonsampleGradN=K.GZ;
0378                 obj.nonsampleVarOrder=K.var;
0379                 <span class="comment">%renormalization of the data</span>
0380                 obj.nonsampleRespOrder=<a href="#_sub20" class="code" title="subfunction dataOut=reNormInputData(obj,type,dataIn)">reNormInputData</a>(obj,<span class="string">'Resp'</span>,obj.nonsampleRespN);
0381                 obj.nonsampleGradOrder=<a href="#_sub20" class="code" title="subfunction dataOut=reNormInputData(obj,type,dataIn)">reNormInputData</a>(obj,<span class="string">'Grad'</span>,obj.nonsampleGradN);
0382                 <span class="comment">%update flags</span>
0383                 obj.runEval=false;
0384                 obj.runErr=true;
0385             <span class="keyword">end</span>
0386             <span class="comment">%extract unnormalized data</span>
0387             Z=obj.nonsampleResp;
0388             GZ=obj.nonsampleGrad;
0389             variance=obj.nonsampleVar;
0390         <span class="keyword">end</span>
0391         <span class="comment">%check interpolation</span>
0392         <a name="_sub26" href="#_subfunctions" class="code">function [ZI,detI]=evalInfill(obj,nonsamplePts)</a>
0393             <span class="comment">%store non sample points</span>
0394             <span class="keyword">if</span> nargin&gt;1;obj.nonsamplePts=nonsamplePts;<span class="keyword">end</span>
0395             <span class="comment">%evaluation</span>
0396             <a href="#_sub26" class="code" title="subfunction [Z,GZ,variance]=eval(obj,nonsamplePts)">eval</a>(obj);
0397             <span class="comment">%smallest response</span>
0398             respMin=min(obj.resp);
0399             <span class="comment">%computation of infill criteria</span>
0400             ZI=[];
0401             <span class="keyword">if</span> ~isempty(obj.nonsampleVar)
0402                 [ZI,detI]=<a href="../GRENAT/src/crit/InfillCrit.html" class="code" title="function [ZI,detInfill]=InfillCrit(respMin,Z,varZ,infillData)">InfillCrit</a>(respMin,obj.nonsampleResp,obj.nonsampleVar,obj.confMeta.infill);
0403             <span class="keyword">end</span>
0404         <span class="keyword">end</span>
0405         <span class="comment">%check interpolation</span>
0406         <a name="_sub27" href="#_subfunctions" class="code">function [statusR,statusG]=checkInterp(obj)</a>
0407             statusG=true;
0408             <span class="comment">%evaluation of the approximation at the sample points</span>
0409             [Z,GZ]=obj.eval(obj.sampling);
0410             <span class="comment">%check interpolation</span>
0411             statusR=<a href="../GRENAT/src/various/checkInterpRG.html" class="code" title="function statusI=checkInterpRG(ZRef,ZApp,type,critR,critG)">checkInterpRG</a>(obj.resp,Z,<span class="string">'resp'</span>);
0412             <span class="keyword">if</span>  obj.dataTrain.used.availGrad
0413                 statusG=<a href="../GRENAT/src/various/checkInterpRG.html" class="code" title="function statusI=checkInterpRG(ZRef,ZApp,type,critR,critG)">checkInterpRG</a>(obj.grad,GZ,<span class="string">'grad'</span>);
0414             <span class="keyword">end</span>
0415         <span class="keyword">end</span>
0416         <span class="comment">%evaluate the CI of the metamodel</span>
0417         <a name="_sub28" href="#_subfunctions" class="code">function [ci68,ci95,ci99]=evalCI(obj,nonsamplePts)</a>
0418             <span class="comment">%store non sample points</span>
0419             <span class="keyword">if</span> nargin&gt;1;obj.nonsamplePts=nonsamplePts;<span class="keyword">end</span>
0420             <span class="comment">%eval the CI</span>
0421             [ci68,ci95,ci99]=<a href="../GRENAT/src/crit/BuildCI.html" class="code" title="function [ci68,ci95,ci99]=BuildCI(ZZ,var)">BuildCI</a>(obj.nonsampleResp,obj.nonsampleVar);
0422             obj.nonsampleCI.ci68=ci68;
0423             obj.nonsampleCI.ci95=ci95;
0424             obj.nonsampleCI.ci99=ci99;
0425         <span class="keyword">end</span>
0426         <span class="comment">%extract CI</span>
0427         <a name="_sub29" href="#_subfunctions" class="code">function [ci68,ci95,ci99]=CI(obj,nonsamplePts)</a>
0428             <span class="comment">%store non sample points</span>
0429             <span class="keyword">if</span> nargin&gt;1;obj.nonsamplePts=nonsamplePts;<span class="keyword">end</span>
0430             <span class="comment">%eval the CI</span>
0431             [ci68,ci95,ci99]=<a href="../GRENAT/src/crit/BuildCI.html" class="code" title="function [ci68,ci95,ci99]=BuildCI(ZZ,var)">BuildCI</a>(obj.nonsampleResp,obj.nonsampleVar);
0432             obj.nonsampleCI.ci68=ci68;
0433             obj.nonsampleCI.ci95=ci95;
0434             obj.nonsampleCI.ci99=ci99;
0435         <span class="keyword">end</span>
0436         <span class="comment">%compute and show the errors of the metamodel (using reference if it is</span>
0437         <span class="comment">%available)</span>
0438         <a name="_sub30" href="#_subfunctions" class="code">function errCalc(obj)</a>
0439             obj.err=<a href="../GRENAT/src/crit/critErrDisp.html" class="code" title="function [err,errV,errNAME]=critErrDisp(Zap,Zref,data)">critErrDisp</a>(obj.nonsampleResp,obj.respRef,obj.dataTrain.build);
0440             obj.runErr=false;
0441         <span class="keyword">end</span>
0442         <span class="comment">%define the reference surface</span>
0443         <a name="_sub31" href="#_subfunctions" class="code">function defineRef(obj,varargin)</a>
0444             <span class="comment">%accepted keyword</span>
0445             keyOk={<span class="string">'sampleRef'</span>,<span class="string">'respRef'</span>,<span class="string">'gradRef'</span>};
0446             <span class="comment">%two kind of input variables list (with keywords or not)</span>
0447             <span class="comment">%depend on the first argument: double for classical list of</span>
0448             <span class="comment">%argument or string if the use of keywords</span>
0449             execOk=true;
0450             <span class="keyword">if</span> isa(varargin{1},<span class="string">'double'</span>)
0451                 <span class="keyword">if</span> nargin&gt;1;obj.sampleRef=varargin{1};obj.nonsamplePts=varargin{1};<span class="keyword">end</span>
0452                 <span class="keyword">if</span> nargin&gt;2;obj.respRef=varargin{2};<span class="keyword">end</span>
0453                 <span class="keyword">if</span> nargin&gt;3;obj.gradRef=varargin{3};<span class="keyword">end</span>
0454             <span class="keyword">elseif</span> isa(varargin{1},<span class="string">'char'</span>)
0455                 <span class="keyword">if</span> mod(nargin-1,2)==0
0456                     <span class="keyword">for</span> itV=1:2:nargin-1
0457                         <span class="comment">%load key and associated value</span>
0458                         keyTxt=varargin{itV};
0459                         keyVal=varargin{itV+1};
0460                         <span class="comment">%check if the keyword is usable</span>
0461                         <span class="keyword">if</span> ismember(keyTxt,keyOk)
0462                             <span class="comment">%store the data</span>
0463                             obj.(keyTxt)=keyVal;
0464                         <span class="keyword">else</span>
0465                             execOk=false;
0466                         <span class="keyword">end</span>
0467                     <span class="keyword">end</span>
0468                 <span class="keyword">else</span>
0469                     execOk=false;
0470                 <span class="keyword">end</span>
0471             <span class="keyword">else</span>
0472                 execOk=false;
0473             <span class="keyword">end</span>
0474             <span class="comment">%display error message if wrong syntax</span>
0475             <span class="keyword">if</span> ~execOk
0476                 fprintf(<span class="string">'Wrong syntax for the method\n'</span>)
0477                 fprintf(<span class="string">'defineref(sampleRef,respRef,gradRef)\n'</span>)
0478                 fprintf(<span class="string">'or defineref(''sampleRef'',val1,''respRef'',val2,''gradRef'',val3)\n'</span>)
0479             <span class="keyword">end</span>
0480         <span class="keyword">end</span>
0481         <span class="comment">%check if all data is available for displaying the reference</span>
0482         <span class="comment">%surface and gradients</span>
0483         <a name="_sub32" href="#_subfunctions" class="code">function [okAll,okSample,okResp,okGrad]=checkRef(obj)</a>
0484             okSample=false;
0485             okResp=false;
0486             okGrad=false;
0487             nbSRef(1)=size(obj.sampleRef,1);
0488             nbSRef(2)=size(obj.sampleRef,2);
0489             nbSRef(3)=size(obj.sampleRef,3);
0490             nbRRef(1)=size(obj.respRef,1);
0491             nbRRef(2)=size(obj.respRef,2);
0492             nbRRef(3)=size(obj.respRef,3);
0493             nbGRef(1)=size(obj.gradRef,1);
0494             nbGRef(2)=size(obj.gradRef,2);
0495             nbGRef(3)=size(obj.gradRef,3);
0496             <span class="keyword">if</span> sum(nbSRef(:))~=0
0497                 okSample=true;
0498                 <span class="keyword">if</span> nbSRef(1)==nbRRef(1)
0499                     okResp=true;
0500                 <span class="keyword">end</span>
0501                 <span class="keyword">if</span> nbGRef(3)==1
0502                     <span class="keyword">if</span> nbGRef(1)==nbSRef(1)&amp;&amp;nbGRef(2)==nbSRef(2)
0503                         okGrad=true;
0504                     <span class="keyword">end</span>
0505                 <span class="keyword">elseif</span> nbGRef(3)==nbSRef(2)&amp;&amp;nbGRef(1)==nbSRef(1)
0506                     okGrad=true;
0507                 <span class="keyword">elseif</span> all(nbGRef==nbSRef)
0508                     okGrad=true;
0509                 <span class="keyword">end</span>
0510             <span class="keyword">end</span>
0511             okAll=okSample&amp;&amp;okResp&amp;&amp;okGrad;
0512             <span class="comment">%display error messages</span>
0513             <span class="keyword">if</span> ~okSample;fprintf(<span class="string">'&gt;&gt; Wrong definition of the reference sample points\n'</span>);<span class="keyword">end</span>
0514             <span class="keyword">if</span> ~okResp;fprintf(<span class="string">'&gt;&gt; Wrong definition of the reference responses\n'</span>);<span class="keyword">end</span>
0515             <span class="keyword">if</span> ~okGrad;fprintf(<span class="string">'&gt;&gt; Wrong definition of the reference gradients\n'</span>);<span class="keyword">end</span>
0516         <span class="keyword">end</span>
0517         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0518         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0519         <span class="comment">%define properties</span>
0520         <a name="_sub33" href="#_subfunctions" class="code">function conf(obj,varargin)</a>
0521             <span class="comment">%list properties</span>
0522             listProp=properties(obj);
0523             okConf=false;
0524             <span class="comment">%if a input variable is specifiec</span>
0525             <span class="keyword">if</span> nargin&gt;2
0526                 <span class="comment">%if the number of input argument is even</span>
0527                 <span class="keyword">if</span>  mod(nargin-1,2)==0
0528                     <span class="comment">%along the argument</span>
0529                     <span class="keyword">for</span> itV=1:2:nargin-1
0530                         <span class="comment">%extract keyword and associated value</span>
0531                         keyW=varargin{itV};
0532                         keyV=varargin{itV+1};
0533                         <span class="comment">%if the first argument is a string</span>
0534                         <span class="keyword">if</span> isa(varargin{1},<span class="string">'char'</span>)
0535                             <span class="comment">%check if the keyword is acceptable</span>
0536                             <span class="keyword">if</span> ismember(keyW,listProp)
0537                                 okConf=true;
0538                                 obj.(keyW)=keyV;
0539                             <span class="keyword">else</span>
0540                                 fprintf(<span class="string">'&gt;&gt; Wrong keyword ''%s''\n'</span>,keyW);
0541                             <span class="keyword">end</span>
0542                         <span class="keyword">end</span>
0543                     <span class="keyword">end</span>
0544                 <span class="keyword">end</span>
0545                 <span class="keyword">if</span> ~okConf
0546                     fprintf(<span class="string">'\nWrong syntax used for conf method\n'</span>)
0547                     fprintf(<span class="string">'use: conf(''key1'',val1,''key2'',val2...)\n'</span>)
0548                     fprintf(<span class="string">'\nList of the available keywords:\n'</span>);
0549                     <a href="#_sub45" class="code" title="subfunction dispTableTwoColumnsStruct(tableFiedIn,structIn)">dispTableTwoColumnsStruct</a>(listProp,obj.infoProp);
0550                 <span class="keyword">end</span>
0551             <span class="keyword">else</span>
0552                 fprintf(<span class="string">'Current configuration\n'</span>);
0553                 disp(obj);
0554             <span class="keyword">end</span>
0555         <span class="keyword">end</span>
0556         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0557         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0558         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0559         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0560         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0561         <span class="comment">%display the surrogate model</span>
0562         <a name="_sub34" href="#_subfunctions" class="code">function show(obj,varargin)</a>
0563             <span class="comment">%depending of the kind of data</span>
0564             <span class="keyword">if</span> obj.sizeNonSample(3)==2
0565                 obj.confDisp.conf(<span class="string">'d3'</span>,true,<span class="string">'contour'</span>,true);
0566                 <span class="comment">%if argument</span>
0567                 <span class="keyword">if</span> nargin&gt;1;obj.confDisp.conf(varargin{:});<span class="keyword">end</span>
0568                 <a href="#_sub37" class="code" title="subfunction show2D(obj)">show2D</a>(obj);
0569             <span class="keyword">elseif</span> obj.sizeNonSample(3)==1
0570                 obj.confDisp.conf(<span class="string">'d3'</span>,false,<span class="string">'d2'</span>,false);
0571                 <span class="comment">%if argument</span>
0572                 <span class="keyword">if</span> nargin&gt;1;obj.confDisp.conf(varargin{:});<span class="keyword">end</span>
0573                 <a href="#_sub36" class="code" title="subfunction show1D(obj)">show1D</a>(obj);
0574             <span class="keyword">end</span>
0575         <span class="keyword">end</span>
0576         <a name="_sub35" href="#_subfunctions" class="code">function show1D(obj)</a>
0577             figure;
0578             <span class="comment">%depend if the reference is available or not</span>
0579             <span class="keyword">if</span> <a href="#_sub33" class="code" title="subfunction [okAll,okSample,okResp,okGrad]=checkRef(obj)">checkRef</a>(obj);
0580                 obj.nbSubplot=231;
0581                 subplot(obj.nbSubplot);
0582                 obj.confDisp.conf(<span class="string">'samplePts'</span>,true,<span class="string">'sampleGrad'</span>,false);
0583                 <a href="#_sub38" class="code" title="subfunction showRespRef(obj)">showRespRef</a>(obj);
0584                 obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot)
0585                 <span class="comment">%remove display of sample points</span>
0586                 obj.confDisp.conf(<span class="string">'samplePts'</span>,true,<span class="string">'sampleGrad'</span>,true);
0587                 <a href="#_sub39" class="code" title="subfunction showGradRef(obj,nbG)">showGradRef</a>(obj);
0588                 obj.nbSubplot=obj.nbSubplot+1;
0589             <span class="keyword">else</span>
0590                 obj.nbSubplot=221;
0591             <span class="keyword">end</span>
0592             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0593             obj.confDisp.conf(<span class="string">'samplePts'</span>,true,<span class="string">'sampleGrad'</span>,false);
0594             <a href="#_sub40" class="code" title="subfunction showResp(obj)">showResp</a>(obj);
0595             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0596             <span class="comment">%remove display of sample points</span>
0597             obj.confDisp.conf(<span class="string">'samplePts'</span>,true,<span class="string">'sampleGrad'</span>,true);
0598             <a href="#_sub41" class="code" title="subfunction showGrad(obj,nbG)">showGrad</a>(obj);
0599             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0600             <a href="#_sub42" class="code" title="subfunction showCI(obj,ciVal,nonsamplePts)">showCI</a>(obj,[]);
0601         <span class="keyword">end</span>
0602         <a name="_sub36" href="#_subfunctions" class="code">function show2D(obj)</a>
0603             figure;
0604             <span class="comment">%depend if the reference is available or not</span>
0605             <span class="keyword">if</span> <a href="#_sub33" class="code" title="subfunction [okAll,okSample,okResp,okGrad]=checkRef(obj)">checkRef</a>(obj);
0606                 obj.nbSubplot=331;
0607                 subplot(obj.nbSubplot);
0608                 obj.confDisp.conf(<span class="string">'samplePts'</span>,true);
0609                 <a href="#_sub38" class="code" title="subfunction showRespRef(obj)">showRespRef</a>(obj);
0610                 obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot)
0611                 <span class="comment">%remove display of sample points</span>
0612                 obj.confDisp.conf(<span class="string">'samplePts'</span>,false,<span class="string">'sampleGrad'</span>,false);
0613                 <a href="#_sub39" class="code" title="subfunction showGradRef(obj,nbG)">showGradRef</a>(obj,1);
0614                 obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot)
0615                 <a href="#_sub39" class="code" title="subfunction showGradRef(obj,nbG)">showGradRef</a>(obj,2);
0616             <span class="keyword">else</span>
0617                 obj.nbSubplot=231;
0618             <span class="keyword">end</span>
0619             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0620             obj.confDisp.conf(<span class="string">'samplePts'</span>,true);
0621             <a href="#_sub40" class="code" title="subfunction showResp(obj)">showResp</a>(obj);
0622             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0623             <span class="comment">%remove display of sample points</span>
0624             obj.confDisp.conf(<span class="string">'samplePts'</span>,false,<span class="string">'sampleGrad'</span>,false,<span class="string">'gridGrad'</span>,false);
0625             <a href="#_sub41" class="code" title="subfunction showGrad(obj,nbG)">showGrad</a>(obj,1);
0626             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0627             <a href="#_sub41" class="code" title="subfunction showGrad(obj,nbG)">showGrad</a>(obj,2);
0628             obj.nbSubplot=obj.nbSubplot+1;subplot(obj.nbSubplot);
0629             <a href="#_sub42" class="code" title="subfunction showCI(obj,ciVal,nonsamplePts)">showCI</a>(obj,[]);
0630         <span class="keyword">end</span>
0631         <span class="comment">%display the reference surface</span>
0632         <a name="_sub37" href="#_subfunctions" class="code">function showRespRef(obj)</a>
0633             obj.confDisp.title=(<span class="string">'Reference'</span>);
0634             <a href="../GRENAT/src/disp/displaySurrogate.html" class="code" title="function figHandle=displaySurrogate(gridXY,Z,sampling,resp,grad,dispData)">displaySurrogate</a>(obj.sampleRef,obj.respRef,obj.sampling,obj.resp,obj.grad,obj.confDisp);
0635         <span class="keyword">end</span>
0636         <span class="comment">%display the reference gradients surface</span>
0637         <a name="_sub38" href="#_subfunctions" class="code">function showGradRef(obj,nbG)</a>
0638             <span class="comment">%default value</span>
0639             <span class="keyword">if</span> nargin==1;nbG=1;<span class="keyword">end</span>
0640             obj.confDisp.title=([<span class="string">'Gradients Reference /x'</span> num2str(nbG)]);
0641             <a href="../GRENAT/src/disp/displaySurrogate.html" class="code" title="function figHandle=displaySurrogate(gridXY,Z,sampling,resp,grad,dispData)">displaySurrogate</a>(obj.sampleRef,obj.gradRef(:,:,nbG),obj.sampling,obj.resp,obj.grad,obj.confDisp);
0642         <span class="keyword">end</span>
0643         <span class="comment">%display the response approximated by the metamodel</span>
0644         <a name="_sub39" href="#_subfunctions" class="code">function showResp(obj)</a>
0645             obj.confDisp.title=(<span class="string">'Approximated responses'</span>);
0646             <a href="../GRENAT/src/disp/displaySurrogate.html" class="code" title="function figHandle=displaySurrogate(gridXY,Z,sampling,resp,grad,dispData)">displaySurrogate</a>(obj.nonsamplePts,obj.nonsampleResp,obj.sampling,obj.resp,obj.grad,obj.confDisp);
0647         <span class="keyword">end</span>
0648         <span class="comment">%display the gradients approximated by the metamodel</span>
0649         <a name="_sub40" href="#_subfunctions" class="code">function showGrad(obj,nbG)</a>
0650             <span class="comment">%default value</span>
0651             <span class="keyword">if</span> nargin==1;nbG=1;<span class="keyword">end</span>
0652             obj.confDisp.title=([<span class="string">'Approximated gradients /x'</span> num2str(nbG)]);
0653             <a href="../GRENAT/src/disp/displaySurrogate.html" class="code" title="function figHandle=displaySurrogate(gridXY,Z,sampling,resp,grad,dispData)">displaySurrogate</a>(obj.nonsamplePts,obj.nonsampleGrad(:,:,nbG),obj.sampling,obj.resp,obj.grad,obj.confDisp);
0654         <span class="keyword">end</span>
0655         <span class="comment">%display the confidence intervals approximated by the metamodel</span>
0656         <a name="_sub41" href="#_subfunctions" class="code">function showCI(obj,ciVal,nonsamplePts)</a>
0657             <span class="comment">%type of confidence intervals</span>
0658             ciOk=false;ciValDef=95;
0659             <span class="keyword">if</span> nargin&gt;1;<span class="keyword">if</span> ~isempty(ciVal);<span class="keyword">if</span> ismember(ciVal,[68,95,99]);ciOk=true;<span class="keyword">end</span>, <span class="keyword">end</span>, <span class="keyword">end</span>
0660             <span class="keyword">if</span> ~ciOk;ciVal=ciValDef;<span class="keyword">end</span>
0661             <span class="comment">%store non sample points</span>
0662             <span class="keyword">if</span> nargin&gt;2;obj.nonsamplePts=nonsamplePts;<span class="keyword">end</span>
0663             obj.confDisp.title=([num2str(ciVal) <span class="string">'% confidence intervals'</span>]);
0664             <span class="comment">%evaluation of the confidence interval</span>
0665             <a href="#_sub29" class="code" title="subfunction [ci68,ci95,ci99]=evalCI(obj,nonsamplePts)">evalCI</a>(obj);
0666             <span class="comment">%load data to display</span>
0667             ciDisp=obj.nonsampleCI.([<span class="string">'ci'</span> num2str(ciVal)]);
0668             <span class="comment">%display the CI</span>
0669             <a href="../GRENAT/src/disp/displaySurrogateCI.html" class="code" title="function displaySurrogateCI(Xpts,ic,dispData,Z)">displaySurrogateCI</a>(obj.nonsamplePts,ciDisp,obj.confDisp,obj.nonsampleResp);
0670         <span class="keyword">end</span>
0671         <span class="comment">%overload isfield</span>
0672         <a name="_sub42" href="#_subfunctions" class="code">function isF=isfield(obj,field)</a>
0673             isF=isprop(obj,field);
0674         <span class="keyword">end</span>
0675     <span class="keyword">end</span>
0676 <span class="keyword">end</span>
0677 
0678 
0679 
0680 
0681 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0682 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0683 <span class="comment">%function for declaring the purpose of each properties</span>
0684 <a name="_sub43" href="#_subfunctions" class="code">function info=affectTxtProp()</a>
0685 info.type=<span class="string">'Type of the surrogate model'</span>;
0686 info.sampling=<span class="string">'Coordinates of the sample points'</span>;
0687 info.resp=<span class="string">'Value(s) of the responses at the sample points'</span>;
0688 info.grad=<span class="string">'Value(s) of the gradients at the sample points'</span>;
0689 info.samplingN=<span class="string">'Normalized coordinates of the sample points'</span>;
0690 info.respN=<span class="string">'Value(s) of the normalized responses at the sample points'</span>;
0691 info.gradN=<span class="string">'Value(s) of the normalized gradients at the sample points'</span>;
0692 info.nonsamplePts=<span class="string">'Coordinates of the non-sample points'</span>;
0693 info.nonsampleResp=<span class="string">'Value(s) of the approximated responses calculated at the non-sample points'</span>;
0694 info.nonsampleGrad=<span class="string">'Value(s) of the approximated gradients calculated at the non-sample points'</span>;
0695 info.nonsamplePtsN=<span class="string">'Normalized coordinates of the  non-sample points'</span>;
0696 info.nonsampleRespN=<span class="string">'Value(s) of the normalized approximated responses calculated at the non-sample points'</span>;
0697 info.nonsampleGradN=<span class="string">'Value(s) of the normalized approximated gradients calculated at the non-sample points'</span>;
0698 info.nonsampleVar=<span class="string">'Value(s) of the variance calculated at the non-sample points'</span>;
0699 info.nonsampleCI=<span class="string">'Structure containing the bounds of the confidence intervals (68%, 95%, 99%)'</span>;
0700 info.nonsampleEI=<span class="string">'Value(s) of the expected improvment calculated at the non-sample points'</span>;
0701 info.norm=<span class="string">'Structure containing the normalization data'</span>;
0702 info.normMeanS=<span class="string">'Mean value of the sample points (vector)'</span>;
0703 info.normStdS=<span class="string">'Standard deviation of the sample points (vector)'</span>;
0704 info.normMeanR=<span class="string">'Mean value of the responses'</span>;
0705 info.normStdR=<span class="string">'Standard deviation of the responses'</span>;
0706 info.err=<span class="string">'Structure containing the values of the error criteria'</span>;
0707 info.sampleRef=<span class="string">'Array of the sample points used for the reference response surface'</span>;
0708 info.respRef=<span class="string">'Array of the responses of the reference response surface'</span>;
0709 info.gradRef=<span class="string">'Array of the gradients of the reference response surface'</span>;
0710 info.confMeta=<span class="string">'Class object (initMeta) containing information about the configuration (metamodel) (conf method for modifying it)'</span>;
0711 info.dataTrain=<span class="string">'Structures containing data about the training of the surrogate model'</span>;
0712 info.confDisp=<span class="string">'Class object (initDisp) containing information about the display (conf method for modifying it)'</span>;
0713 info.miss=<span class="string">'Structure Containing information about the missing data'</span>;
0714 <span class="keyword">end</span>
0715 
0716 <span class="comment">%function display table with two columns of text</span>
0717 <a name="_sub44" href="#_subfunctions" class="code">function dispTableTwoColumnsStruct(tableFiedIn,structIn)</a>
0718 <span class="comment">%size of every components in tableA</span>
0719 sizeA=cellfun(@numel,tableFiedIn);
0720 maxA=max(sizeA);
0721 <span class="comment">%space after each component</span>
0722 spaceA=maxA-sizeA+3;
0723 spaceTxt=<span class="string">' '</span>;
0724 <span class="comment">%display table</span>
0725 <span class="keyword">for</span> itT=1:numel(tableFiedIn)
0726     <span class="keyword">if</span> <a href="#_sub43" class="code" title="subfunction isF=isfield(obj,field)">isfield</a>(structIn,tableFiedIn{itT})
0727         fprintf(<span class="string">'%s%s%s\n'</span>,tableFiedIn{itT},spaceTxt(ones(1,spaceA(itT))),structIn.(tableFiedIn{itT}));
0728     <span class="keyword">end</span>
0729 <span class="keyword">end</span>
0730 <span class="keyword">end</span>
0731 
0732 <span class="comment">%function display table with two columns of text</span>
0733 <a name="_sub45" href="#_subfunctions" class="code">function dispTableTwoColumns(tableA,tableB)</a>
0734 <span class="comment">%size of every components in tableA</span>
0735 sizeA=cellfun(@numel,tableA);
0736 maxA=max(sizeA);
0737 <span class="comment">%space after each component</span>
0738 spaceA=maxA-sizeA+3;
0739 spaceTxt=<span class="string">' '</span>;
0740 <span class="comment">%display table</span>
0741 <span class="keyword">for</span> itT=1:numel(tableA)
0742     fprintf(<span class="string">'%s%s%s\n'</span>,tableA{itT},spaceTxt(ones(1,spaceA(itT))),tableB{itT});
0743 <span class="keyword">end</span>
0744 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 12-Sep-2016 18:26:33 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>