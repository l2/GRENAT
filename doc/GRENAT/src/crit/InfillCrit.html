<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of InfillCrit</title>
  <meta name="keywords" content="InfillCrit">
  <meta name="description" content="% Compute infill criteria EI/WEI/LCB">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html crit -->
<h1>InfillCrit
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Compute infill criteria EI/WEI/LCB</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [ZI,detInfill]=InfillCrit(respMin,Z,varZ,infillData) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Compute infill criteria EI/WEI/LCB
 L. LAURENT -- 04/05/2012 -- luc.laurent@lecnam.net</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>	% function for printing information on the command window (based on fprintf)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/GRENAT.html" class="code" title="">GRENAT</a>	% GRENAT class for manipulating gradient-enhanced metamodels</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Compute infill criteria EI/WEI/LCB</span>
0002 <span class="comment">% L. LAURENT -- 04/05/2012 -- luc.laurent@lecnam.net</span>
0003 
0004 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0005 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0006 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0009 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0010 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0011 <span class="comment">%     (at your option) any later version.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0014 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0015 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0016 <span class="comment">%     GNU General Public License for more details.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0019 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0020 
0021 <a name="_sub0" href="#_subfunctions" class="code">function [ZI,detInfill]=InfillCrit(respMin,Z,varZ,infillData)</a>
0022 
0023 <span class="comment">%Gfprintf('  &gt;&gt;&gt; Compute infill criteria\n');</span>
0024 
0025 <span class="comment">%depending on the kind of infill criteria to be computed</span>
0026 calcEI=false;
0027 calcWEI=false;
0028 calcGEI=false;
0029 calcLCB=false;
0030 calcExploit=false;
0031 calcExplor=false;
0032 
0033 <span class="comment">%initialize outuput variables</span>
0034 exploitEI=[];
0035 explorEI=[];
0036 
0037 <span class="keyword">if</span> isfield(infillData,<span class="string">'crit'</span>)
0038     <span class="keyword">if</span> ~isempty(infillData.crit)
0039         <span class="keyword">switch</span> infillData.crit
0040             <span class="keyword">case</span> <span class="string">'EI'</span>
0041                 calcEI=true;calcExploit=true;calcExplor=true;
0042             <span class="keyword">case</span> <span class="string">'WEI'</span>
0043                 calcWEI=true;calcExploit=true;calcExplor=true;
0044             <span class="keyword">case</span> <span class="string">'GEI'</span>
0045                 calcGEI=true;calcExploit=true;calcExplor=true;
0046             <span class="keyword">case</span> <span class="string">'LCB'</span>
0047                 calcLCB=true;
0048             <span class="keyword">case</span> <span class="string">'exploitEI'</span>
0049                 calcExploit=true;
0050             <span class="keyword">case</span> <span class="string">'explorEI'</span>
0051                 calcExplor=true;
0052         <span class="keyword">end</span>
0053     <span class="keyword">end</span>
0054 <span class="keyword">else</span>
0055     calcEI=true;
0056 <span class="keyword">end</span>
0057 
0058 <span class="comment">%dimensions</span>
0059 nbv=size(Z);
0060 
0061 <span class="comment">%check variance</span>
0062 ixInf=find(varZ&lt;0);
0063 <span class="keyword">if</span> ~isempty(ixInf)
0064     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'Issue: variance lower than zero at %i points \n'</span>,numel(ixInf));
0065     disp(varZ(ixInf))
0066     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'&gt; Correction to zero\n'</span>);
0067     varZ(ixInf)=0;
0068 <span class="keyword">end</span>
0069 ixInf=find(varZ&lt;eps);
0070 <span class="keyword">if</span> ~isempty(ixInf)
0071     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'Issue: variance close to zero at %i points \n'</span>,numel(ixInf));
0072     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'&gt; Correction to zero\n'</span>);
0073     varZ(ixInf)=0;
0074 <span class="keyword">end</span>
0075 
0076 
0077 <span class="comment">%compute standard deviation</span>
0078 respStd=sqrt(varZ);
0079 
0080 <span class="comment">%minimal response</span>
0081 diffEI=(respMin-Z);
0082 u=diffEI./respStd;
0083 
0084 <span class="comment">%for computation of the Expected Improvement (Schonlau 1997/Jones 1999/Bompard</span>
0085 <span class="comment">%2011/Sobester 2005...)</span>
0086 <span class="comment">%exploration (using probabilty density)</span>
0087 densProb=1/sqrt(2*pi)*exp(-0.5*u.^2); <span class="comment">%normpdf</span>
0088 <span class="keyword">if</span> calcExplor || calcEI || calcWEI
0089     explorEI=respStd.*densProb;
0090     ZI=explorEI;
0091 <span class="keyword">end</span>
0092 
0093 <span class="comment">%exploitation (cumulative distribution function)</span>
0094 cumDist=0.5*(1+erf(u/sqrt(2))); <span class="comment">%cdf</span>
0095 <span class="keyword">if</span> calcExploit || calcEI || calcWEI
0096     exploitEI=diffEI.*cumDist;
0097     ZI=exploitEI;
0098 <span class="keyword">end</span>
0099 
0100 <span class="comment">%deal with specific case: variance lower than 0 or close to 0</span>
0101 <span class="keyword">if</span> ~isempty(ixInf)
0102     u(ixInf)=0;
0103     <span class="keyword">if</span> calcExplor || calcEI || calcWEI
0104         explorEI(ixInf)=0;
0105         ZI=explorEI;
0106     <span class="keyword">end</span>
0107     <span class="keyword">if</span> calcExploit || calcEI || calcWEI
0108         exploitEI(ixInf)=0;
0109         ZI=exploitEI;
0110     <span class="keyword">end</span>
0111 <span class="keyword">end</span>
0112 
0113 <span class="comment">%Weigthed Expected Improvement (Sobester 2005)</span>
0114 <span class="keyword">if</span> calcWEI
0115     nbParaWEI=numel(infillData.paraWEI);
0116     <span class="keyword">if</span> nbParaWEI~=1
0117         paraWEI=reshape(infillData.paraWEI,1,1,nbParaWEI);
0118         paraWEI=repmat(paraWEI,[nbv(1),nbv(2),1]);
0119         WEI=paraWEI.*repmat(exploitEI,[1 1 nbParaWEI])<span class="keyword">...</span>
0120             +(1-paraWEI).*repmat(explorEI,[1 1 nbParaWEI]);
0121     <span class="keyword">else</span>
0122         WEI=infillData.paraWEI.*exploitEI+(1-infillData.paraWEI)*explorEI;
0123     <span class="keyword">end</span>
0124     ZI=WEI;
0125 <span class="keyword">end</span>
0126 
0127 <span class="comment">%Expected Improvement (Schonlau 1997)</span>
0128 <span class="keyword">if</span> calcEI
0129     EI=exploitEI+explorEI;
0130     ZI=EI;
0131 <span class="keyword">end</span>
0132 
0133 <span class="comment">%Lower Confidence Bound (Cox et John 1997)</span>
0134 <span class="keyword">if</span> calcLCB
0135     LCB=Z-infillData.para_lcb*respStd;
0136     <span class="comment">%deal with specific case: variance lower than 0 or close to 0</span>
0137     <span class="keyword">if</span> ~isempty(ixInf)
0138         LCB(ixInf)=0;
0139     <span class="keyword">end</span>
0140     ZI=LCB;
0141 <span class="keyword">end</span>
0142 
0143 <span class="comment">% Generalized Expected Improvement (Schonlau 1997)</span>
0144 <span class="comment">% if the parameter is equal to 1 &gt;&gt; Expectied Improvement</span>
0145 <span class="keyword">if</span> calcGEI
0146     g=max(infillData.paraGEI);
0147     t=zeros(nbv(1),nbv(2),g);
0148     GEI=zeros(nbv(1),nbv(2),g+1);
0149     <span class="keyword">if</span> respStd~=0
0150         <span class="keyword">if</span> g&gt;=0
0151             t(:,:,1)=cumDist;
0152         <span class="keyword">end</span>
0153         <span class="keyword">if</span> g&gt;=1
0154             t(:,:,2)=-densProb;
0155         <span class="keyword">end</span>
0156         <span class="keyword">if</span> g&gt;=2
0157             <span class="keyword">for</span> kk=3:g+1
0158                 t(:,:,kk)=u.^(kk-1).*t(1)+(kk-1).*t(kk-2);
0159             <span class="keyword">end</span>
0160         <span class="keyword">end</span>
0161         
0162         <span class="comment">%compute various terms for calculating GEI</span>
0163         <span class="keyword">for</span> cg=0:g
0164             kIte=reshape(0:cg,[1,1,cg+1]);
0165             <span class="comment">%coefficent</span>
0166             coefGEI=(-1).^kIte;
0167             <span class="comment">%variance to the power</span>
0168             varG=respStd.^cg;
0169             <span class="comment">% binomail coefficeent</span>
0170             binomialC=factorial(cg)./(factorial(kIte).*factorial(cg-kIte)); <span class="comment">%faster than nchoosek (10 times faster)</span>
0171             <span class="comment">% u to the power</span>
0172             pow=cg-kIte;
0173             uEG=bsxfun(@power,u,pow);
0174             <span class="comment">%compute terms of the sum</span>
0175             coefF=coefGEI.*binomialC;
0176             prodA=bsxfun(@times,coefF,uEG.*t(:,:,1:cg+1));
0177             s=sum(prodA,3);
0178             <span class="comment">%computer GEI criteria</span>
0179             GEI(:,:,cg+1)=varG.*sum_tmp;
0180         <span class="keyword">end</span>
0181     <span class="keyword">end</span>
0182     ZI=GEI;
0183 <span class="keyword">end</span>
0184 
0185 <span class="comment">%details of the enrichement</span>
0186 detInfill.exploitEI=exploitEI;
0187 detInfill.explorEI=explorEI;</pre></div>
<hr><address>Generated on Thu 09-Feb-2017 16:13:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>