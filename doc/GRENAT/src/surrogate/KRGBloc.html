<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of KRGBloc</title>
  <meta name="keywords" content="KRGBloc">
  <meta name="description" content="% Building of the KRG/GKRG matrix and computation of the log-likelihood">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html surrogate -->
<h1>KRGBloc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Building of the KRG/GKRG matrix and computation of the log-likelihood</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [lilog,ret]=KRGBloc(dataIn,metaData,paraValIn,type) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Building of the KRG/GKRG matrix and computation of the log-likelihood
 L. LAURENT -- 05/01/2011 -- luc.laurent@lecnam.net

 the kernel matrix K can be also designated as the correlation matrix

this function can be used as an objective function for finding
hyperparameters via optimization</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="KRGLikelihood.html" class="code" title="function [logLi,Li,liSack]=KRGLikelihood(dataKRG)">KRGLikelihood</a>	% Function for computing Likelihood and Log-likelihood of the krigind</li><li><a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>	% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</li><li><a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>	% function for printing information on the command window (based on fprintf)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="KRGBuild.html" class="code" title="function [ret]=KRGBuild(samplingIn,respIn,gradIn,metaData,missData)">KRGBuild</a>	% function for building kriging and cokriging surrogate model</li><li><a href="SVRBuild.html" class="code" title="function [ret]=SVRBuild(samplingIn,respIn,gradIn,metaData,missData)">SVRBuild</a>	% function for building gradient and non-gradient based SVR</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Building of the KRG/GKRG matrix and computation of the log-likelihood</span>
0002 <span class="comment">% L. LAURENT -- 05/01/2011 -- luc.laurent@lecnam.net</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% the kernel matrix K can be also designated as the correlation matrix</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%this function can be used as an objective function for finding</span>
0007 <span class="comment">%hyperparameters via optimization</span>
0008 
0009 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0010 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0011 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0014 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0015 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0016 <span class="comment">%     (at your option) any later version.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0019 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0020 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0021 <span class="comment">%     GNU General Public License for more details.</span>
0022 <span class="comment">%</span>
0023 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0024 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0025 
0026 <a name="_sub0" href="#_subfunctions" class="code">function [lilog,ret]=KRGBloc(dataIn,metaData,paraValIn,type)</a>
0027 
0028 <span class="comment">%coefficient for reconditionning (co)kriging matrix</span>
0029 coefRecond=(10+size(dataIn.build.fct,1))*eps;
0030 <span class="comment">% chosen factorization for (G)KRG matrix</span>
0031 <span class="keyword">if</span> strcmp(metaData.type,<span class="string">'GKRG'</span>)
0032     factKK=<span class="string">'LU'</span>;
0033 <span class="keyword">else</span>
0034     factKK=<span class="string">'LU'</span> ; <span class="comment">%LU %QR %LL %None</span>
0035 <span class="keyword">end</span>
0036 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0037 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0038 <span class="comment">%Load useful variables</span>
0039 ns=dataIn.used.ns;
0040 np=dataIn.used.np;
0041 fctKern=metaData.kern;
0042 ret=[];
0043 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0044 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0045 <span class="comment">%if the hyperparameter is defined</span>
0046 final=false;
0047 <span class="keyword">if</span> nargin&gt;=3
0048     paraVal=paraValIn;
0049 <span class="keyword">else</span>
0050     paraVal=metaData.para.Val;
0051     final=true;
0052 <span class="keyword">end</span>
0053 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0054 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0055 <span class="comment">%Build of the KRG/GRKG matrix</span>
0056 
0057 <span class="keyword">if</span> dataIn.used.availGrad
0058     [KK,KKa,KKi]=<a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>(fctKern,dataIn,paraVal);
0059     KK=[KK -KKa;-KKa' -KKi];
0060 <span class="keyword">else</span>
0061     [KK]=<a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>(fctKern,dataIn,paraVal);
0062 <span class="keyword">end</span>
0063 
0064 <span class="comment">%in the case of missing data</span>
0065 <span class="comment">%responses</span>
0066 <span class="keyword">if</span> metaData.miss.resp.on
0067     KK(metaData.miss.resp.ix_miss,:)=[];
0068     KK(:,metaData.miss.resp.ix_miss)=[];
0069 <span class="keyword">end</span>
0070 <span class="comment">%gradients</span>
0071 <span class="keyword">if</span> dataIn.used.availGrad
0072     <span class="keyword">if</span> metaData.miss.grad.on
0073         rep_ev=ns-metaData.miss.resp.nb;
0074         KK(rep_ev+metaData.miss.grad.ixt_miss_line,:)=[];
0075         KK(:,rep_ev+metaData.miss.grad.ixt_miss_line)=[];
0076     <span class="keyword">end</span>
0077 <span class="keyword">end</span>
0078 
0079 <span class="comment">% if datain.used.pres_grad</span>
0080 <span class="comment">%     %si parallelisme actif ou non</span>
0081 <span class="comment">%     if metaData.worker_parallel&gt;=2</span>
0082 <span class="comment">%         %%%%%% PARALLEL %%%%%%</span>
0083 <span class="comment">%         %morceaux de la matrice GKRG</span>
0084 <span class="comment">%         rc=zeros(ns,ns);</span>
0085 <span class="comment">%         rca=cell(1,ns);</span>
0086 <span class="comment">%         rci=cell(1,ns);</span>
0087 <span class="comment">%         parfor ii=1:ns</span>
0088 <span class="comment">%             %distance 1 tirages aux autres (construction par colonne)</span>
0089 <span class="comment">%             one_tir=tiragesn(ii,:);</span>
0090 <span class="comment">%             dist=one_tir(ones(1,ns),:)-tiragesn;</span>
0091 <span class="comment">%             % evaluation de la fonction de correlation</span>
0092 <span class="comment">%             [ev,dev,ddev]=feval(fctKern,dist,paraVal);</span>
0093 <span class="comment">%             %morceau de la matrice issue du modele KRG classique</span>
0094 <span class="comment">%             rc(:,ii)=ev;</span>
0095 <span class="comment">%             %morceau des derivees premieres</span>
0096 <span class="comment">%             rca{ii}=dev;</span>
0097 <span class="comment">%             %matrice des derivees secondes</span>
0098 <span class="comment">%             rci{ii}=-reshape(ddev,np,ns*np);</span>
0099 <span class="comment">%         end</span>
0100 <span class="comment">%         %%construction des matrices completes</span>
0101 <span class="comment">%         rcaC=horzcat(rca{:});</span>
0102 <span class="comment">%         rciC=vertcat(rci{:});</span>
0103 <span class="comment">%         %Matrice de complete</span>
0104 <span class="comment">%         rcc=[rc rcaC;rcaC' rciC];</span>
0105 <span class="comment">%     else</span>
0106 <span class="comment">%</span>
0107 <span class="comment">%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0108 <span class="comment">%         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0109 <span class="comment">%         %evaluation de la fonction de correlation pour les differents</span>
0110 <span class="comment">%         %intersites</span>
0111 <span class="comment">%         [ev,dev,ddev]=feval(fctKern,datain.used.dist,paraVal);</span>
0112 <span class="comment">%</span>
0113 <span class="comment">%         %morceau de la matrice issu du krigeage</span>
0114 <span class="comment">%         rc=zeros(ns,ns);</span>
0115 <span class="comment">%         rca=zeros(ns,np*ns);</span>
0116 <span class="comment">%         rci=zeros(ns*np,ns*np);</span>
0117 <span class="comment">%</span>
0118 <span class="comment">%         rc(datain.usedd.matrix)=ev;</span>
0119 <span class="comment">%         rc=rc+rc'-eye(datain.used.nb_val);</span>
0120 <span class="comment">%</span>
0121 <span class="comment">%         rca(datain.usedd.matrixA)=dev(datain.usedd.dev);</span>
0122 <span class="comment">%         rca(datain.usedd.matrixAb)=-dev(datain.usedd.devb);</span>
0123 <span class="comment">%         rci(datain.usedd.matrixI)=-ddev(:);</span>
0124 <span class="comment">%         %extraction de la diagonale (procedure pour eviter les doublons)</span>
0125 <span class="comment">%         diago=0;   % //!!\\ corrections envisageables ici</span>
0126 <span class="comment">%         val_diag=spdiags(rci,diago);</span>
0127 <span class="comment">%         rci=rci+rci'-spdiags(val_diag,diago,zeros(size(rci))); %correction termes diagonaux pour eviter les doublons</span>
0128 <span class="comment">%</span>
0129 <span class="comment">%         %Matrice de correlation du Cokrigeage</span>
0130 <span class="comment">%         rcc=[rc rca;rca' rci];</span>
0131 <span class="comment">%     end</span>
0132 <span class="comment">%     %si donnees manquantes</span>
0133 <span class="comment">%     if dataIn.manq.eval.on</span>
0134 <span class="comment">%         rcc(dataIn.manq.eval.ix_manq,:)=[];</span>
0135 <span class="comment">%         rcc(:,dataIn.manq.eval.ix_manq)=[];</span>
0136 <span class="comment">%     end</span>
0137 <span class="comment">%</span>
0138 <span class="comment">%     %si donnees manquantes</span>
0139 <span class="comment">%     if dataIn.manq.grad.on</span>
0140 <span class="comment">%         rep_ev=ns-dataIn.manq.eval.nb;</span>
0141 <span class="comment">%         rcc(rep_ev+dataIn.manq.grad.ixt_manq_line,:)=[];</span>
0142 <span class="comment">%         rcc(:,rep_ev+dataIn.manq.grad.ixt_manq_line)=[];</span>
0143 <span class="comment">%     end</span>
0144 <span class="comment">% else</span>
0145 <span class="comment">%</span>
0146 <span class="comment">%     if metaData.worker_parallel&gt;=2</span>
0147 <span class="comment">%         %%%%%% PARALLEL %%%%%%</span>
0148 <span class="comment">%         %matrice de KRG classique par bloc</span>
0149 <span class="comment">%         rcc=zeros(ns,ns);</span>
0150 <span class="comment">%         parfor ii=1:ns</span>
0151 <span class="comment">%             %distance 1 tirages aux autres (construction par colonne)</span>
0152 <span class="comment">%             one_tir=tiragesn(ii,:);</span>
0153 <span class="comment">%             dist=one_tir(ones(1,ns),:)-tiragesn;</span>
0154 <span class="comment">%             % evaluation de la fonction de correlation</span>
0155 <span class="comment">%             [ev]=feval(fctKern,dist,paraVal);</span>
0156 <span class="comment">%             %morceau de la matrice issue du modele RBF classique</span>
0157 <span class="comment">%             rcc(:,ii)=ev;</span>
0158 <span class="comment">%         end</span>
0159 <span class="comment">%     else</span>
0160 <span class="comment">%         %matrice de correlation du Krigeage par matrice triangulaire inferieure</span>
0161 <span class="comment">%         %sans diagonale</span>
0162 <span class="comment">%         rcc=zeros(ns,ns);</span>
0163 <span class="comment">%         % evaluation de la fonction de correlation</span>
0164 <span class="comment">%         [ev]=feval(fctKern,datain.used.dist,paraVal);</span>
0165 <span class="comment">%         rcc(datain.usedd.matrix)=ev;</span>
0166 <span class="comment">%         %Construction matrice complete</span>
0167 <span class="comment">%         rcc=rcc+rcc'+eye(ns);</span>
0168 <span class="comment">%     end</span>
0169 <span class="comment">%     %toc</span>
0170 <span class="comment">%     %si donnees manquantes</span>
0171 <span class="comment">%     if dataIn.manq.eval.on</span>
0172 <span class="comment">%         rcc(dataIn.manq.eval.ix_manq,:)=[];</span>
0173 <span class="comment">%         rcc(:,dataIn.manq.eval.ix_manq)=[];</span>
0174 <span class="comment">%     end</span>
0175 <span class="comment">% end</span>
0176 
0177 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0178 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0179 <span class="comment">%Improve condition number of the KRG/GKRG Matrix</span>
0180 <span class="keyword">if</span> metaData.recond
0181     <span class="comment">%origCond=condest(rcc);</span>
0182     KK=KK+coefRecond*speye(size(KK));
0183     <span class="comment">%newCond=condest(rcc);</span>
0184     <span class="comment">%Gfprintf('&gt;&gt;&gt; Improving of the condition number: \n%g &gt;&gt; %g  &lt;&lt;&lt;\n',...</span>
0185     <span class="comment">%    origCond,newCond);</span>
0186     
0187 <span class="keyword">end</span>
0188 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0189 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0190 <span class="comment">%condition number of the KRG/GKRG Matrix</span>
0191 <span class="keyword">if</span> final   <span class="comment">% in the phase of building</span>
0192     newCond=condest(KK);
0193     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'Condition number KRG/GKRG matrix: %4.2e\n'</span>,newCond);
0194     <span class="keyword">if</span> newCond&gt;1e16
0195         <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'+++ //!\\ Bad condition number\n'</span>);
0196     <span class="keyword">end</span>
0197 <span class="keyword">end</span>
0198 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0199 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0200 <span class="comment">%Factorization of the matrix</span>
0201 <span class="keyword">switch</span> factKK
0202     <span class="keyword">case</span> <span class="string">'QR'</span>
0203         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0204         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0205         <span class="comment">%QR factorization</span>
0206         [QK,RK,PK]=qr(KK);
0207         QtK=QK';
0208         yQ=QtK*dataIn.build.y;
0209         fctQ=QtK*dataIn.build.fct;
0210         fcK=dataIn.build.fc*PK/RK;
0211         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0212         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0213         <span class="comment">%compute beta coefficient</span>
0214         fcCfct=fcK*fctQ;
0215         block2=fcK*yQ;
0216         beta=fcCfct\block2;
0217         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0218         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0219         <span class="comment">%compute gamma coefficient</span>
0220         gamma=PK*(RK\(yQ-fctQ*beta));
0221         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0222         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0223         <span class="comment">%save variables</span>
0224         buildData.yQ=yQ;
0225         buildData.fctQ=fctQ;
0226         buildData.fcK=fcK;
0227         buildData.fcCfct=fcCfct;
0228         buildData.RK=RK;
0229         buildData.QK=QK;
0230         buildData.QtK=QtK;
0231         buildData.PK=PK;
0232         
0233     <span class="keyword">case</span> <span class="string">'LU'</span>
0234         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0235         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0236         <span class="comment">%LU factorization</span>
0237         [LK,UK,PK]=lu(KK,<span class="string">'vector'</span>);
0238         yP=dataIn.build.y(PK,:);
0239         fctP=dataIn.build.fct(PK,:);
0240         yL=LK\yP;
0241         fctL=LK\fctP;
0242         fcU=dataIn.build.fc/UK;
0243         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0244         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0245         <span class="comment">%compute beta coefficient</span>
0246         fcCfct=fcU*fctL;
0247         block2=fcU*yL;
0248         beta=fcCfct\block2;
0249         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0250         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0251         <span class="comment">%compute gamma coefficient</span>
0252         gamma=UK\(yL-fctL*beta);
0253         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0254         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0255         <span class="comment">%save variables</span>
0256         buildData.yL=yL;
0257         buildData.fcU=fcU;
0258         buildData.fctL=fctL;
0259         buildData.fcCfct=fcCfct;
0260         buildData.LK=LK;
0261         buildData.UK=UK;
0262         buildData.PK=PK;
0263     <span class="keyword">case</span> <span class="string">'LL'</span>
0264         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0265         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0266         <span class="comment">%Cholesky's fatorization</span>
0267         <span class="comment">%%% to be degugged</span>
0268         LK=chol(KK,<span class="string">'lower'</span>);
0269         LtK=LK';
0270         yL=LK\dataIn.build.y;
0271         fctL=LK\dataIn.build.fct;
0272         fcL=dataIn.build.fc/LtK;
0273         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0274         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0275         <span class="comment">%compute beta coefficient</span>
0276         fcCfct=fcL*fctL;
0277         block2=fcL*yL;
0278         beta=fcCfct\block2;
0279         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0280         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0281         <span class="comment">%compute gamma coefficient</span>
0282         gamma=LtK\(yL-fctL*beta);
0283         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0284         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0285         <span class="comment">%save variables</span>
0286         buildData.yL=yL;
0287         buildData.fcL=fcL;
0288         buildData.fctL=fctL;
0289         buildData.fcCfct=fcCfct;
0290         buildData.LtK=LtK;
0291         buildData.LK=LK;
0292     <span class="keyword">otherwise</span>
0293         <span class="comment">%classical approach</span>
0294         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0295         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0296         <span class="comment">%compute gamma and beta coefficients</span>
0297         fcC=dataIn.build.fc/KK;
0298         fcCfct=fcC*dataIn.build.fct;
0299         block2=((dataIn.build.fc/KK)*dataIn.build.y);
0300         beta=fcCfct\block2;
0301         gamma=KK\(dataIn.build.y-dataIn.build.fct*beta);
0302         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0303         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0304         <span class="comment">%save variables</span>
0305         buildData.fcC=fcC;
0306         buildData.fcCfct=fcCfct;
0307 <span class="keyword">end</span>
0308 
0309 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0310 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0311 <span class="comment">%store variables</span>
0312 <span class="keyword">if</span> exist(<span class="string">'origCond'</span>,<span class="string">'var'</span>);buildData.origCond=origCond;<span class="keyword">end</span>
0313 <span class="keyword">if</span> exist(<span class="string">'newCond'</span>,<span class="string">'var'</span>);buildData.newCond=newCond;<span class="keyword">end</span>
0314 
0315 buildData.beta=beta;
0316 buildData.gamma=gamma;
0317 buildData.KK=KK;
0318 buildData.polyOrder=metaData.polyOrder;
0319 buildData.para=metaData.para;
0320 buildData.factKK=factKK;
0321 ret.build=buildData;
0322 
0323 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0324 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0325 <span class="comment">%variance of the Gaussian process</span>
0326 ret.build.sig2=1/size(KK,1)*<span class="keyword">...</span>
0327     ((dataIn.build.y-dataIn.build.fct*ret.build.beta)'*ret.build.gamma);
0328 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0329 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0330 <span class="comment">%compute of the Likelihood (and log-likelihood)</span>
0331 [lilog,ret.li]=<a href="KRGLikelihood.html" class="code" title="function [logLi,Li,liSack]=KRGLikelihood(dataKRG)">KRGLikelihood</a>(ret);
0332 ret.lilog=lilog;
0333 <span class="comment">%</span>
0334 <span class="keyword">if</span> metaData.norm.on&amp;&amp;~isempty(metaData.norm.resp.std)
0335     ret.build.sig2=ret.build.sig2*metaData.norm.resp.std^2;
0336 <span class="keyword">end</span>
0337 <span class="comment">%% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></pre></div>
<hr><address>Generated on Thu 09-Feb-2017 16:13:09 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>