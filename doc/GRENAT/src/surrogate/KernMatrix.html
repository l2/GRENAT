<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of KernMatrix</title>
  <meta name="keywords" content="KernMatrix">
  <meta name="description" content="% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html surrogate -->
<h1>KernMatrix
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model
 L. LAURENT -- 27/04/2016 -- luc.laurent@lecnam.net</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>	% function for evaluating multidimensional kernel function</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="KRGBloc.html" class="code" title="function [lilog,ret]=KRGBloc(dataIn,metaData,paraValIn,type)">KRGBloc</a>	% Building of the KRG/GKRG matrix and computation of the log-likelihood</li><li><a href="RBFBloc.html" class="code" title="function [critMin,ret]=RBFBloc(dataIn,metaData,paraValIn,type)">RBFBloc</a>	% Building of the RBF/GRBF matrix and computation of the CV criteria</li><li><a href="SVRBloc.html" class="code" title="function [critMin,ret]=SVRBloc(dataIn,metaData,paraValIn,type)">SVRBloc</a>	% Building of the nu-SVR/GSVR matrix</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</span>
0002 <span class="comment">% L. LAURENT -- 27/04/2016 -- luc.laurent@lecnam.net</span>
0003 
0004 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0005 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0006 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0009 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0010 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0011 <span class="comment">%     (at your option) any later version.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0014 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0015 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0016 <span class="comment">%     GNU General Public License for more details.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0019 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0020 
0021 <a name="_sub0" href="#_subfunctions" class="code">function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)</a>
0022 
0023 <span class="keyword">if</span> nargin&lt;4;parallelW=1;<span class="keyword">end</span>
0024 <span class="comment">%kernel derivatives matrices required</span>
0025 <span class="keyword">if</span> nargout&gt;1;KerMatrixD=true;<span class="keyword">else</span> KerMatrixD=false;<span class="keyword">end</span>
0026 <span class="comment">%extract data</span>
0027 distC=dataIn.used.dist;
0028 ns=dataIn.used.ns;
0029 np=dataIn.used.np;
0030 <span class="comment">%if derivatives required</span>
0031 <span class="keyword">if</span> KerMatrixD
0032     <span class="comment">%if parallel workers are available</span>
0033     <span class="keyword">if</span> parallelW&gt;=2
0034         <span class="comment">%%%%%% PARALLEL %%%%%%</span>
0035         <span class="comment">%various parts of the Kernel Matrix</span>
0036         KK=zeros(ns,ns);
0037         KKa=cell(1,ns);
0038         KKi=cell(1,ns);
0039         
0040         parfor ii=1:ns
0041             <span class="comment">%Building by column &amp; evaluation of the Kernel function</span>
0042             [ev,dev,ddev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(fctKern,distC(:,ii),paraVal);
0043             <span class="comment">%classical part</span>
0044             KK(:,ii)=ev;
0045             <span class="comment">%part of the first derivatives</span>
0046             KKa{ii}=dev;
0047             <span class="comment">%part of the second derivatives</span>
0048             KKi{ii}=reshape(ddev,np,ns*np);
0049         <span class="keyword">end</span>
0050         <span class="comment">%Reordering matrices</span>
0051         KKd=horzcat(KKa{:});
0052         KKdd=vertcat(KKi{:});
0053     <span class="keyword">else</span>
0054         <span class="comment">%evaluation of the kernel function for all inter-points</span>
0055         [ev,dev,ddev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(fctKern,distC,paraVal);        
0056         <span class="comment">%various parts of the kernel Matrix</span>
0057         KK=zeros(ns,ns);
0058         KKd=zeros(ns,np*ns);
0059         KKdd=zeros(ns*np,ns*np);
0060         <span class="comment">%classical part</span>
0061         KK(dataIn.ix.matrix)=ev;
0062         <span class="comment">%correction of the duplicated terms on the diagonal</span>
0063         KK=KK+KK'-eye(dataIn.used.ns);
0064         <span class="comment">%first and second derivatives of the kernel function</span>
0065         KKd(dataIn.ix.matrixA)=-dev(dataIn.ix.dev);
0066         KKd(dataIn.ix.matrixAb)=dev(dataIn.ix.devb);
0067         KKdd(dataIn.ix.matrixI)=ddev(:);
0068         <span class="comment">%extract diagonal (process for avoiding duplicate terms)</span>
0069         diago=0;   <span class="comment">% //!!\\ corrections possible here</span>
0070         val_diag=spdiags(KKdd,diago);
0071         KKdd=KKdd+KKdd'-spdiags(val_diag,diago,zeros(size(KKdd))); <span class="comment">%correction of the duplicated terms on the diagonal</span>
0072     <span class="keyword">end</span>
0073 <span class="keyword">else</span>
0074     <span class="keyword">if</span> parallelW&gt;=2
0075         <span class="comment">%%%%%% PARALLEL %%%%%%</span>
0076         <span class="comment">%classical kernel matrix by column</span>
0077         KK=zeros(ns,ns);
0078         parfor ii=1:ns
0079             <span class="comment">% evaluate kernel function</span>
0080             [ev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(fctKern,distC(:,ii),paraVal);
0081             <span class="comment">% kernel matrix by column</span>
0082             KK(:,ii)=ev;
0083         <span class="keyword">end</span>
0084     <span class="keyword">else</span>
0085         <span class="comment">%classical kernel matrix (lower triangular matrix)</span>
0086         <span class="comment">%without diagonal</span>
0087         KK=zeros(ns,ns);
0088         <span class="comment">% evaluate kernel function</span>
0089         [ev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(fctKern,distC,paraVal);
0090         KK(dataIn.ix.matrix)=ev;
0091         <span class="comment">%Build full kernel matrix</span>
0092         KK=KK+KK'+eye(ns);
0093     <span class="keyword">end</span>
0094 <span class="keyword">end</span>
0095 <span class="keyword">end</span>
0096</pre></div>
<hr><address>Generated on Wed 18-Jan-2017 10:43:21 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>