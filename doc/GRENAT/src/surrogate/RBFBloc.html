<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of RBFbloc</title>
  <meta name="keywords" content="RBFbloc">
  <meta name="description" content="% Building of the RBF/GRBF matrix and computation of the CV criteria">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html surrogate -->
<h1>RBFbloc
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Building of the RBF/GRBF matrix and computation of the CV criteria</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [critMin,ret]=RBFBloc(dataIn,metaData,paraValIn,type) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Building of the RBF/GRBF matrix and computation of the CV criteria
 L. LAURENT -- 24/01/2012 -- luc.laurent@lecnam.net

this function can be used as an objective function for finding
hyperparameters via optimization</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>	% Function for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</li><li><a href="RBFCV.html" class="code" title="function [cv]=RBFCV(dataBloc,data,metaData,type)">RBFCV</a>	% Function for computing various Cross-Validation criteria for RBF/GRBF</li><li><a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>	% function for printing information on the command window (based on fprintf)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="RBFBuild.html" class="code" title="function ret=RBFBuild(samplingIn,respIn,gradIn,metaData)">RBFBuild</a>	% Function for building Radial Basis Function surrogate model</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function retStatus=modWarning(requireStatus,oldStatus)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Building of the RBF/GRBF matrix and computation of the CV criteria</span>
0002 <span class="comment">% L. LAURENT -- 24/01/2012 -- luc.laurent@lecnam.net</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%this function can be used as an objective function for finding</span>
0005 <span class="comment">%hyperparameters via optimization</span>
0006 
0007 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0008 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0009 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0012 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0013 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0014 <span class="comment">%     (at your option) any later version.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0017 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0018 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0019 <span class="comment">%     GNU General Public License for more details.</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0022 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0023 
0024 <a name="_sub0" href="#_subfunctions" class="code">function [critMin,ret]=RBFBloc(dataIn,metaData,paraValIn,type)</a>
0025 
0026 <span class="comment">% display warning(s) or not</span>
0027 dispWarning=false;
0028 statusWarning=<a href="#_sub1" class="code" title="subfunction retStatus=modWarning(requireStatus,oldStatus)">modWarning</a>([],[]);
0029 <span class="comment">% function to be minimised for finding hyperparameters</span>
0030 fctMin=<span class="string">'eloot'</span>; <span class="comment">%eloot/eloor/eloog</span>
0031 <span class="comment">%coefficient of reconditionning</span>
0032 coefRecond=eps;
0033 <span class="comment">% chosen factorization for RBF matrix</span>
0034 factKK=<span class="string">'LU'</span> ; <span class="comment">%LU %QR %LL %None</span>
0035 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0036 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0037 <span class="comment">%Load useful variables</span>
0038 ns=dataIn.used.ns;
0039 np=dataIn.used.np;
0040 fctKern=metaData.kern;
0041 ret=[];
0042 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0043 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0044 <span class="comment">%if the hyperparameter is defined</span>
0045 <span class="keyword">if</span> nargin&gt;=3
0046     paraVal=paraValIn;
0047     <span class="comment">%in this case, the single required criterion is computed (estimation)</span>
0048     typeCV=<span class="string">'estim'</span>;
0049 <span class="keyword">else</span>
0050     paraVal=metaData.para.Val;
0051     typeCV=<span class="string">'final'</span>;
0052 <span class="keyword">end</span>
0053 metaData.para.l.val=paraVal;
0054 
0055 <span class="keyword">if</span> nargin==4
0056     <span class="keyword">if</span> strcmp(type,<span class="string">'etud'</span>);typeCV=type;<span class="keyword">end</span>
0057     <span class="keyword">if</span> strcmp(type,<span class="string">'estim'</span>);typeCV=type;<span class="keyword">end</span>
0058 <span class="keyword">end</span>
0059 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0060 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0061 <span class="comment">%Build of the RBF/GRBF matrix</span>
0062 <span class="keyword">if</span> dataIn.used.availGrad
0063     [KK,KKa,KKi]=<a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>(fctKern,dataIn,paraVal);
0064     KK=[KK KKa;-KKa' KKi];
0065 <span class="keyword">else</span>
0066     [KK]=<a href="KernMatrix.html" class="code" title="function [KK,KKd,KKdd]=KernMatrix(fctKern,dataIn,paraVal,parallelW)">KernMatrix</a>(fctKern,dataIn,paraVal);
0067 <span class="keyword">end</span>
0068 <span class="comment">%in the case of missing data</span>
0069 <span class="comment">%responses</span>
0070 <span class="keyword">if</span> metaData.miss.resp.on
0071     KK(metaData.miss.resp.ix_miss,:)=[];
0072     KK(:,metaData.miss.resp.ix_miss)=[];
0073 <span class="keyword">end</span>
0074 <span class="comment">%gradients</span>
0075 <span class="keyword">if</span> dataIn.used.availGrad
0076     <span class="keyword">if</span> metaData.miss.grad.on
0077         rep_ev=ns-metaData.miss.resp.nb;
0078         KK(rep_ev+metaData.miss.grad.ixt_miss_line,:)=[];
0079         KK(:,rep_ev+metaData.miss.grad.ixt_miss_line)=[];
0080     <span class="keyword">end</span>
0081 <span class="keyword">end</span>
0082 
0083 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0084 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0085 <span class="comment">%Improve condition number of the RBF/GRBF Matrix</span>
0086 <span class="keyword">if</span> metaData.recond
0087     <span class="comment">%origCond=condest(KK);</span>
0088     KK=KK+coefRecond*speye(size(KK));
0089     <span class="comment">%newCond=condest(KK);</span>
0090 <span class="comment">%          Gfprintf('&gt;&gt;&gt; Improving of the condition number: \n%g &gt;&gt; %g (%g) &lt;&lt;&lt;\n',...</span>
0091 <span class="comment">%              origCond,newCond,abs(origCond-newCond)/origCond);</span>
0092     
0093 <span class="keyword">end</span>
0094 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0095 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0096 <span class="comment">%condition number of the RBF/GRBF Matrix</span>
0097 <span class="keyword">if</span> nargin==2 <span class="comment">% in the phase of building</span>
0098     newCond=condest(KK);
0099     <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'Condition number RBF/GRBF matrix: %4.2e\n'</span>,newCond)
0100     <span class="keyword">if</span> newCond&gt;1e16
0101         <a href="../../../GRENAT/src/various/Gfprintf.html" class="code" title="function nbT = Gfprintf(varargin)">Gfprintf</a>(<span class="string">'+++ //!\\ Bad condition number\n'</span>);
0102     <span class="keyword">end</span>
0103 <span class="keyword">end</span>
0104 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0105 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0106 <span class="comment">%Factorization of the matrix</span>
0107 <span class="keyword">switch</span> factKK
0108     <span class="keyword">case</span> <span class="string">'QR'</span>
0109         <span class="comment">%expensive</span>
0110         [QKK,RKK,PKK]=qr(KK);
0111         iKK=PKK*(RKK\QKK');
0112         yQ=QKK'*dataIn.build.y;
0113         w=PKK*(RKK\yQ);
0114     <span class="keyword">case</span> <span class="string">'LU'</span>
0115         <span class="comment">%</span>
0116         [LKK,UKK,PKK]=lu(KK);
0117         iKK=UKK\(LKK\PKK);
0118         yL=LKK\PKK*dataIn.build.y;
0119         w=UKK\yL;
0120     <span class="keyword">case</span> <span class="string">'LL'</span>
0121         <span class="comment">%symetric definite-positive matrix</span>
0122         LKK=chol(KK,<span class="string">'lower'</span>);
0123         iKK=LKK'\inv(LKK);
0124         yL=LKK\dataIn.build.y;
0125         w=LKK'\yL;
0126     <span class="keyword">otherwise</span>
0127         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0128         <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0129         <span class="comment">%classical approach</span>
0130         <span class="keyword">if</span> ~dispWarning; warning off all;<span class="keyword">end</span>
0131         w=KK\dataIn.build.y;
0132         <span class="keyword">if</span> ~dispWarning; warning on all;<span class="keyword">end</span>
0133         
0134 <span class="keyword">end</span>
0135 
0136 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0137 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0138 <span class="comment">%store variables</span>
0139 <span class="keyword">if</span> exist(<span class="string">'origCond'</span>,<span class="string">'var'</span>);buildData.origCond=origCond;<span class="keyword">end</span>
0140 <span class="keyword">if</span> exist(<span class="string">'newCond'</span>,<span class="string">'var'</span>);buildData.newCond=newCond;<span class="keyword">end</span>
0141 <span class="keyword">if</span> exist(<span class="string">'QKK'</span>,<span class="string">'var'</span>);buildData.QKK=QKK;<span class="keyword">end</span>
0142 <span class="keyword">if</span> exist(<span class="string">'RKK'</span>,<span class="string">'var'</span>);buildData.RKK=RKK;<span class="keyword">end</span>
0143 <span class="keyword">if</span> exist(<span class="string">'LKK'</span>,<span class="string">'var'</span>);buildData.LKK=LKK;<span class="keyword">end</span>
0144 <span class="keyword">if</span> exist(<span class="string">'UKK'</span>,<span class="string">'var'</span>);buildData.UKK=UKK;<span class="keyword">end</span>
0145 <span class="keyword">if</span> exist(<span class="string">'iKK'</span>,<span class="string">'var'</span>);buildData.iKK=iKK;<span class="keyword">end</span>
0146 <span class="keyword">if</span> exist(<span class="string">'yQ'</span>,<span class="string">'var'</span>);buildData.yQ=yQ;<span class="keyword">end</span>
0147 buildData.w=w;
0148 buildData.KK=KK;
0149 buildData.kern=metaData.kern;
0150 buildData.para=metaData.para;
0151 ret.build=buildData;
0152 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0153 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0154 <span class="comment">%%%%%Cross-Validation (mandatory for estimating the hyperparameters</span>
0155 <span class="comment">%%%%%Computation of various errors</span>
0156 <span class="keyword">if</span> metaData.cv.on||metaData.para.estim
0157     [cv]=<a href="RBFCV.html" class="code" title="function [cv]=RBFCV(dataBloc,data,metaData,type)">RBFCV</a>(ret,dataIn,metaData,typeCV);
0158     <span class="keyword">if</span> isfield(cv,fctMin)
0159         critMin=cv.(fctMin);
0160     <span class="keyword">else</span>
0161         critMin=cv.eloot;
0162     <span class="keyword">end</span>
0163 <span class="keyword">else</span>
0164     cv=[];
0165     critMin=[];
0166 <span class="keyword">end</span>
0167 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0168 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0169 ret.build.cv=cv;
0170 <a href="#_sub1" class="code" title="subfunction retStatus=modWarning(requireStatus,oldStatus)">modWarning</a>([],statusWarning)
0171 <span class="keyword">end</span>
0172 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0173 <span class="comment">% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0174 <span class="comment">% function for stopping the display of the warning and restoring initial</span>
0175 <span class="comment">% state</span>
0176 <a name="_sub1" href="#_subfunctions" class="code">function retStatus=modWarning(requireStatus,oldStatus)</a>
0177 <span class="keyword">if</span> nargin==1
0178 <span class="keyword">if</span> ~requireStatus
0179     warning off all
0180 <span class="keyword">end</span>    
0181 <span class="keyword">else</span>
0182     <span class="keyword">if</span> isempty(oldStatus)
0183         retStatus=warning;
0184     <span class="keyword">else</span>
0185         warning(oldStatus)
0186     <span class="keyword">end</span>
0187 <span class="keyword">end</span>
0188 <span class="keyword">end</span>
0189</pre></div>
<hr><address>Generated on Mon 12-Sep-2016 17:29:34 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>