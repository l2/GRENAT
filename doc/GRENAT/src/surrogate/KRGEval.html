<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of KRGEval</title>
  <meta name="keywords" content="KRGEval">
  <meta name="description" content="% function for evaluating the (co)Kriging surrogate model at many points">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html surrogate -->
<h1>KRGEval
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% function for evaluating the (co)Kriging surrogate model at many points</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [Z,GZ,variance,details]=KRGEval(U,metaData,specifSampling) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% function for evaluating the (co)Kriging surrogate model at many points
 KRG: w/o gradient
 GKRG: w/- gradients
 L. LAURENT -- 15/12/2011 -- luc.laurent@lecnam.net</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>	% function for evaluating multidimensional kernel function</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="EvalMeta.html" class="code" title="function [Z]=EvalMeta(evalSample,dataTrain,metaConf,Verb)">EvalMeta</a>	% Evaluation of the surrogate model</li><li><a href="KRGCV.html" class="code" title="function cv=KRGCV(dataBloc,metaData,type)">KRGCV</a>	% Function for computing various Cross-Validation criteria for KRG/GKRG</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% function for evaluating the (co)Kriging surrogate model at many points</span>
0002 <span class="comment">% KRG: w/o gradient</span>
0003 <span class="comment">% GKRG: w/- gradients</span>
0004 <span class="comment">% L. LAURENT -- 15/12/2011 -- luc.laurent@lecnam.net</span>
0005 
0006 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0007 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0008 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0011 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0012 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0013 <span class="comment">%     (at your option) any later version.</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0016 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0017 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0018 <span class="comment">%     GNU General Public License for more details.</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0021 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0022 
0023 <a name="_sub0" href="#_subfunctions" class="code">function [Z,GZ,variance,details]=KRGEval(U,metaData,specifSampling)</a>
0024 <span class="comment">% display warning or not</span>
0025 dispWarning=false;
0026 <span class="comment">%load varibales</span>
0027 ns=metaData.used.ns;
0028 np=metaData.used.np;
0029 
0030 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0031 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0032 <span class="comment">%computation of thr gradients or not (depending on the number of output variables)</span>
0033 <span class="keyword">if</span> nargout&gt;=2
0034     calcGrad=true;
0035 <span class="keyword">else</span>
0036     calcGrad=false;
0037 <span class="keyword">end</span>
0038 <span class="comment">% specific sampled points</span>
0039 <span class="keyword">if</span> nargin==3
0040     sampling=specifSampling;
0041 <span class="keyword">else</span>
0042     sampling=metaData.used.sampling;
0043 <span class="keyword">end</span>
0044 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0045 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0046 X=U;
0047 dimX=size(X,1);
0048 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0049 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0050 <span class="comment">%distance from evaluation point to sample points</span>
0051 distS=repmat(X,ns,1)-sampling;
0052 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0053 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0054 <span class="comment">%% KRG/GKRG</span>
0055 <span class="comment">%%compute response provided by the metamodel at the non sample point</span>
0056 <span class="comment">%definition des dimensions of the matrix/vector for KRG or GKRG</span>
0057 <span class="keyword">if</span> metaData.used.availGrad
0058     sizeMatVec=ns*(np+1);
0059 <span class="keyword">else</span>
0060     sizeMatVec=ns;
0061 <span class="keyword">end</span>
0062 
0063 <span class="comment">%kernel (correlation) vector between sample point and the non sample point</span>
0064 rr=zeros(sizeMatVec,1);
0065 <span class="keyword">if</span> calcGrad
0066     jr=zeros(sizeMatVec,np);
0067 <span class="keyword">end</span>
0068 
0069 <span class="comment">%KRG/GKRG</span>
0070 <span class="keyword">if</span> metaData.used.availGrad
0071     <span class="keyword">if</span> calcGrad  <span class="comment">%if compute gradients</span>
0072         <span class="comment">%evaluate kernel function</span>
0073         [ev,dev,ddev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(metaData.build.kern,distS,metaData.build.para.Val);
0074         rr(1:ns)=ev;
0075         rr(ns+1:sizeMatVec)=-reshape(dev',1,ns*np);
0076         
0077         <span class="comment">%derivative of the kernel vector between sample point and the non sample point</span>
0078         jr(1:ns,:)=dev;
0079         
0080         <span class="comment">% second derivatives</span>
0081         matDer=zeros(np,np*ns);
0082         <span class="keyword">for</span> mm=1:ns
0083             matDer(:,(mm-1)*np+1:mm*np)=ddev(:,:,mm);
0084         <span class="keyword">end</span>
0085         jr(ns+1:sizeMatVec,:)=-matDer';
0086         
0087         <span class="comment">%if missing responses</span>
0088         <span class="keyword">if</span> metaData.miss.resp.on
0089             rr(metaData.miss.resp.ixMiss)=[];
0090             jr(metaData.miss.resp.ixMiss,:)=[];
0091         <span class="keyword">end</span>
0092         
0093         <span class="comment">%if missing gradients</span>
0094         <span class="keyword">if</span> metaData.miss.grad.on
0095             repEv=metaData.used.ns-metaData.miss.resp.nb;
0096             rr(repEv+metaData.miss.grad.ixtMissLine)=[];
0097             jr(repEv+metaData.miss.grad.ixtMissLine,:)=[];
0098         <span class="keyword">end</span>
0099         
0100     <span class="keyword">else</span> <span class="comment">%otherwise</span>
0101         [ev,dev]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(metaData.build.kern,distS,metaData.build.para.val);
0102         rr(1:ns)=ev;
0103         rr(ns+1:sizeMatVec)=reshape(dev',1,ns*np);
0104         <span class="comment">%if missing data</span>
0105         <span class="keyword">if</span> metaData.miss.resp.on
0106             rr(metaData.miss.resp.ixMiss)=[];
0107             <span class="keyword">if</span> metaData.miss.grad.on
0108                 repEv=metaData.used.ns-metaData.miss.resp.nb;
0109                 rr(repEv+metaData.miss.grad.ixtMissLine)=[];
0110             <span class="keyword">end</span>
0111         <span class="keyword">end</span>
0112     <span class="keyword">end</span>
0113 <span class="keyword">else</span>
0114     <span class="keyword">if</span> calcGrad  <span class="comment">%if the gradients will be computed</span>
0115         [rr,jr]=<a href="../../../GRENAT/src/kernANDfun/multiKernel.html" class="code" title="function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara)">multiKernel</a>(metaData.build.kern,distS,metaData.build.para.Val);
0116     <span class="keyword">else</span> <span class="comment">%otherwise</span>
0117         rr=feval(metaData.build.kern,distS,metaData.build.para.Val);
0118     <span class="keyword">end</span>
0119     <span class="comment">%if missing data</span>
0120     <span class="keyword">if</span> metaData.miss.resp.on
0121         rr(metaData.miss.resp.ixMiss)=[];
0122         jr(metaData.miss.resp.ixMiss,:)=[];
0123     <span class="keyword">end</span>
0124 <span class="keyword">end</span>
0125 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0126 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0127 <span class="comment">%regression matrix at the non-sample points</span>
0128 <span class="keyword">if</span> calcGrad
0129     [ff,~,jf,~]=feval(metaData.build.funPoly,X);
0130     jf=vertcat(jf{:});
0131 <span class="keyword">else</span>
0132     ff=feval(metaData.build.funPoly,X);
0133 <span class="keyword">end</span>
0134 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0135 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0136 <span class="comment">%evaluation of the surrogate model at point X</span>
0137 trZ=ff*metaData.build.beta;
0138 stoZ=rr'*metaData.build.gamma;
0139 Z=trZ+stoZ;
0140 <span class="keyword">if</span> calcGrad
0141     <span class="comment">%%verif in 2D+</span>
0142     trGZ=jf*metaData.build.beta;
0143     stoGZ=jr'*metaData.build.gamma;
0144     GZ=trGZ+stoGZ;
0145 <span class="keyword">end</span>
0146 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0147 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0148 <span class="comment">%compute the prediction variance (MSE) (Lophaven, Nielsen &amp; Sondergaard</span>
0149 <span class="comment">%2004 / Marcelet 2008 / Chauvet 1999)</span>
0150 <span class="keyword">if</span> nargout &gt;=3
0151     <span class="keyword">if</span> ~dispWarning;warning off all;<span class="keyword">end</span>
0152     <span class="comment">%depending on the factorization</span>
0153     <span class="keyword">switch</span> metaData.build.factKK
0154         <span class="keyword">case</span> <span class="string">'QR'</span>
0155             rrP=rr'*metaData.build.PK;
0156             Qrr=metaData.build.QtK*rr;
0157             u=metaData.build.fcR*Qrr-ff';
0158             variance=metaData.build.sig2*(ones(dimX,1)-(rrP/metaData.build.RK)*Qrr+<span class="keyword">...</span>
0159                 u'/metaData.build.fcCfct*u);
0160         <span class="keyword">case</span> <span class="string">'LU'</span>
0161             rrP=rr(metaData.build.PK,:);
0162             Lrr=metaData.build.LK\rrP;
0163             u=metaData.build.fcU*Lrr-ff';
0164             variance=metaData.build.sig2*(ones(dimX,1)-(rr'/metaData.build.UK)*Lrr+<span class="keyword">...</span>
0165                 u'/metaData.build.fcCfct*u);
0166         <span class="keyword">case</span> <span class="string">'LL'</span>
0167             Lrr=metaData.build.LK\rr;
0168             u=metaData.build.fcL*Lrr-ff';
0169             variance=metaData.build.sig2*(ones(dimX,1)-(rr'/metaData.build.LtK)*Lrr+<span class="keyword">...</span>
0170                 u'/metaData.build.fcCfct*u);
0171         <span class="keyword">otherwise</span>
0172             rKrr=metaData.build.KK \ rr;
0173             u=metaData.build.fc*rKrr-ff';
0174             variance=metaData.build.sig2*(ones(dimX,1)+u'/metaData.build.fcCfct*u - rr'*rKrr);
0175     <span class="keyword">end</span>
0176     <span class="keyword">if</span> ~dispWarning;warning on all;<span class="keyword">end</span>
0177     
0178 <span class="keyword">end</span>
0179 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0180 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0181 <span class="comment">%extraction details</span>
0182 <span class="keyword">if</span> nargout==4
0183     details.trZ=trZ;
0184     details.stoZ=stoZ;
0185     details.trGZ=trGZ;
0186     details.stoGZ=stoGZ;
0187 <span class="keyword">end</span>
0188 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 04-Aug-2016 12:37:32 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>