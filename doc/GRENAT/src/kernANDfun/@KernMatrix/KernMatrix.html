<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of KernMatrix</title>
  <meta name="keywords" content="KernMatrix">
  <meta name="description" content="% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../../menu.html GRENATdevel --><!-- # src --><!-- ../menu.html kernANDfun --><!-- menu.html @KernMatrix -->
<h1>KernMatrix
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model
 L. LAURENT -- 27/04/2016 -- luc.laurent@lecnam.net
 class version - 18/07/2017</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="KernMatrix.html" class="code" title="">KernMatrix</a>	% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="KernMatrix.html" class="code" title="">KernMatrix</a>	% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</li><li><a href="../../../../GRENATdevel/src/surrogate/@KRG/setData.html" class="code" title="function setData(obj)">setData</a>	% prepare data for building (deal with missing data)</li><li><a href="../../../../GRENATdevel/src/surrogate/@RBF/setData.html" class="code" title="function setData(obj)">setData</a>	% prepare data for building (deal with missing data)</li><li><a href="../../../../GRENATdevel/src/surrogate/RBFBloc.html" class="code" title="function [critMin,ret]=RBFBloc(dataIn,metaData,paraValIn,type)">RBFBloc</a>	% Building of the RBF/GRBF matrix and computation of the CV criteria</li><li><a href="../../../../GRENATdevel/src/surrogate/SVRBloc.html" class="code" title="function [critMin,ret]=SVRBloc(dataIn,metaData,paraValIn,type)">SVRBloc</a>	% Building of the nu-SVR/GSVR matrix</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function obj=KernMatrix(fct,sampling,val,parallel)</a></li><li><a href="#_sub2" class="code">function set.fctKern(obj,fct)</a></li><li><a href="#_sub3" class="code">function set.computeD(obj,bool)</a></li><li><a href="#_sub4" class="code">function set.paraVal(obj,pV)</a></li><li><a href="#_sub5" class="code">function set.forceGrad(obj,boolIn)</a></li><li><a href="#_sub6" class="code">function nb=get.nbParaOk(obj)</a></li><li><a href="#_sub7" class="code">function nS=get.nS(obj)</a></li><li><a href="#_sub8" class="code">function nS=get.NnS(obj)</a></li><li><a href="#_sub9" class="code">function nP=get.nP(obj)</a></li><li><a href="#_sub10" class="code">function pO=get.parallelOk(obj)</a></li><li><a href="#_sub11" class="code">function init(obj)</a></li><li><a href="#_sub12" class="code">function f=checkMatrix(obj)</a></li><li><a href="#_sub13" class="code">function l=loadKern(obj)</a></li><li><a href="#_sub14" class="code">function fRun(obj);obj.requireRun=true;end</a></li><li><a href="#_sub15" class="code">function fGrad(obj);obj.forceGrad=true;end</a></li><li><a href="#_sub16" class="code">function fIX(obj);obj.requireIndices=true;end</a></li><li><a href="#_sub17" class="code">function nbP=computeNbPara(obj)</a></li><li><a href="#_sub18" class="code">function K=getKK(obj)</a></li><li><a href="#_sub19" class="code">function K=getKKd(obj)</a></li><li><a href="#_sub20" class="code">function K=getKKdd(obj)</a></li><li><a href="#_sub21" class="code">function showKernel(obj)</a></li><li><a href="#_sub22" class="code">function dispTableTwoColumnsStruct(tableFieldIn,structIn)</a></li><li><a href="#_sub23" class="code">function dispTableTwoColumns(tableA,tableB)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Class for building Kernel Matrix for classical and gradient-enhanced kernel-based surrogate model</span>
0002 <span class="comment">% L. LAURENT -- 27/04/2016 -- luc.laurent@lecnam.net</span>
0003 <span class="comment">% class version - 18/07/2017</span>
0004 
0005 <span class="comment">%     GRENAT - GRadient ENhanced Approximation Toolbox</span>
0006 <span class="comment">%     A toolbox for generating and exploiting gradient-enhanced surrogate models</span>
0007 <span class="comment">%     Copyright (C) 2016  Luc LAURENT &lt;luc.laurent@lecnam.net&gt;</span>
0008 <span class="comment">%</span>
0009 <span class="comment">%     This program is free software: you can redistribute it and/or modify</span>
0010 <span class="comment">%     it under the terms of the GNU General Public License as published by</span>
0011 <span class="comment">%     the Free Software Foundation, either version 3 of the License, or</span>
0012 <span class="comment">%     (at your option) any later version.</span>
0013 <span class="comment">%</span>
0014 <span class="comment">%     This program is distributed in the hope that it will be useful,</span>
0015 <span class="comment">%     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
0016 <span class="comment">%     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
0017 <span class="comment">%     GNU General Public License for more details.</span>
0018 <span class="comment">%</span>
0019 <span class="comment">%     You should have received a copy of the GNU General Public License</span>
0020 <span class="comment">%     along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
0021 
0022 classdef <a href="KernMatrix.html" class="code" title="">KernMatrix</a> &lt; handle
0023     properties
0024         KK=[];                  <span class="comment">% matrix of kernel</span>
0025         KKd=[];                 <span class="comment">% matrix of first derivatives</span>
0026         KKdd=[];                <span class="comment">% matrix of second derivatives</span>
0027         <span class="comment">%</span>
0028         paraVal=[];             <span class="comment">% values of the internal parameters</span>
0029         sampling=[];            <span class="comment">% sampling points</span>
0030         newSample=[];           <span class="comment">% in the cas of adding new sample points</span>
0031         distC=[];               <span class="comment">% vector of inter-points distances</span>
0032         distN=[];               <span class="comment">% vector of inter-points distances for new sample points</span>
0033         distNO=[];              <span class="comment">% vector of inter-points distances for new sample points (distance to the old ones)</span>
0034         fctKern=<span class="string">'sexp'</span>;         <span class="comment">% chosen kernel function</span>
0035     <span class="keyword">end</span>
0036     properties (Dependent)
0037         
0038     <span class="keyword">end</span>
0039     
0040     properties (Access = private)
0041         computeD=false;         <span class="comment">% flag for computing matrices with gradients</span>
0042         parallelW=1;            <span class="comment">% number of workers for using parallel version</span>
0043         <span class="comment">%</span>
0044         iX;                     <span class="comment">% structure of indices</span>
0045         NiX;                    <span class="comment">% structure of indices for new sampling points</span>
0046         requireRun=true;        <span class="comment">% flag if a full building is required</span>
0047         requireUpdate=false;    <span class="comment">% flag if an update is required</span>
0048         requireIndices=true;    <span class="comment">% flag if an update of indices is required</span>
0049         forceGrad=false;        <span class="comment">% flag for forcing the computation of 1st and énd derivatives of the kernel matrix</span>
0050         <span class="comment">%</span>
0051         nbParaOk=[];            <span class="comment">%number of acceptable internal parameters</span>
0052         listKernel={<span class="string">'sexp'</span>,<span class="string">'matern'</span>,<span class="string">'matern32'</span>,<span class="string">'matern52'</span>};  <span class="comment">%list of available kernel functions</span>
0053         listKernelTxt={<span class="string">'Squared exponential'</span>,<span class="string">'Matern'</span>,<span class="string">'Matern 3/2'</span>,<span class="string">'Matern 5/2'</span>};  <span class="comment">%list of available kernel functions</span>
0054     <span class="keyword">end</span>
0055     properties (Dependent,Access = private)
0056         NnS;                    <span class="comment">% number of new sample points</span>
0057         nS;                     <span class="comment">% number of sample points</span>
0058         nP;                     <span class="comment">% dimension of the problem</span>
0059         parallelOk=false;       <span class="comment">% flag for using parallel version</span>
0060         <span class="comment">%</span>
0061     <span class="keyword">end</span>
0062     <span class="comment">%</span>
0063     methods
0064         <span class="comment">%%constructor</span>
0065         <a name="_sub0" href="#_subfunctions" class="code">function obj=KernMatrix(fct,sampling,val,parallel)</a>
0066             <span class="comment">%load arguments</span>
0067             obj.fctKern=fct;
0068             obj.paraVal=val;
0069             obj.sampling=sampling;
0070             <span class="keyword">if</span> nargin&gt;3;obj.parallelW=parallel;<span class="keyword">end</span>
0071         <span class="keyword">end</span>
0072         <span class="comment">%% setter and getter</span>
0073         <span class="comment">%setter for kernel function</span>
0074         <a name="_sub1" href="#_subfunctions" class="code">function set.fctKern(obj,fct)</a>
0075             checkKernel=any(ismember(obj.loadKern,fct));
0076             <span class="keyword">if</span> checkKernel
0077                 obj.fctKern=fct;
0078             <span class="keyword">else</span>
0079                 fprintf(<span class="string">'Kernel function %s not available (maintain %s)\n'</span>,fct,obj.fctKern);
0080                 obj.showKernel;
0081             <span class="keyword">end</span>
0082         <span class="keyword">end</span>
0083         <span class="comment">%setter for gradients calculations</span>
0084         <a name="_sub2" href="#_subfunctions" class="code">function set.computeD(obj,bool)</a>
0085             oldFlag=obj.computeD;
0086             <span class="keyword">if</span> ~oldFlag&amp;&amp;bool
0087                 obj.fRun;
0088             <span class="keyword">end</span>
0089             obj.computeD=bool;
0090         <span class="keyword">end</span>
0091         <span class="comment">%setter for internal parameter</span>
0092         <a name="_sub3" href="#_subfunctions" class="code">function set.paraVal(obj,pV)</a>
0093             oldpV=obj.paraVal;
0094             <span class="keyword">if</span> ~isempty(oldpV)
0095                 <span class="keyword">if</span> numel(oldpV(:))==numel(pV(:))
0096                     <span class="keyword">if</span> ~all(oldpV(:)==pV(:))
0097                         obj.fRun;
0098                     <span class="keyword">end</span>
0099                 <span class="keyword">else</span>
0100                     obj.fRun;
0101                 <span class="keyword">end</span>
0102             <span class="keyword">else</span>
0103                 obj.fRun;
0104             <span class="keyword">end</span>
0105             obj.paraVal=pV;
0106         <span class="keyword">end</span>
0107         <span class="comment">%setter for the flag to force gradient-matrix computation</span>
0108         <a name="_sub4" href="#_subfunctions" class="code">function set.forceGrad(obj,boolIn)</a>
0109             oldFG=obj.forceGrad;
0110             <span class="keyword">if</span> ~oldFG&amp;&amp;boolIn
0111                 obj.fRun;
0112             <span class="keyword">end</span>
0113             obj.forceGrad=boolIn;
0114         <span class="keyword">end</span>
0115         
0116         <span class="comment">%getter for the number of acceptable internal parameters</span>
0117         <a name="_sub5" href="#_subfunctions" class="code">function nb=get.nbParaOk(obj)</a>
0118             nb=obj.computeNbPara;
0119         <span class="keyword">end</span>
0120         <span class="comment">%getter for the number of sample points</span>
0121         <a name="_sub6" href="#_subfunctions" class="code">function nS=get.nS(obj)</a>
0122             nS=size(obj.sampling,1);
0123         <span class="keyword">end</span>
0124         <span class="comment">%getter for the number of new sample points</span>
0125         <a name="_sub7" href="#_subfunctions" class="code">function nS=get.NnS(obj)</a>
0126             nS=size(obj.newSample,1);
0127         <span class="keyword">end</span>
0128         <span class="comment">%getter for the dimension</span>
0129         <a name="_sub8" href="#_subfunctions" class="code">function nP=get.nP(obj)</a>
0130             nP=size(obj.sampling,2);
0131         <span class="keyword">end</span>
0132         <span class="comment">%getter for the flag for parallel</span>
0133         <a name="_sub9" href="#_subfunctions" class="code">function pO=get.parallelOk(obj)</a>
0134             pO=(obj.parallelW&gt;1);
0135         <span class="keyword">end</span>
0136         
0137         
0138         <span class="comment">%% other methods</span>
0139         <span class="comment">%initialize all flag</span>
0140         <a name="_sub10" href="#_subfunctions" class="code">function init(obj)</a>
0141             obj.requireRun=true;     <span class="comment">% flag if a full building is required</span>
0142             obj.requireUpdate=false; <span class="comment">% flag if an update is required</span>
0143             obj.requireIndices=true; <span class="comment">% flag if an update of indices is required</span>
0144         <span class="keyword">end</span>
0145         <span class="comment">%check matrices</span>
0146         <a name="_sub11" href="#_subfunctions" class="code">function f=checkMatrix(obj)</a>
0147             <span class="comment">%check symetry</span>
0148             fS=all(all(obj.KK==obj.KK'));
0149             <span class="comment">%check eye</span>
0150             fE=all(diag(obj.KK)==1);
0151             <span class="comment">%check the adding process</span>
0152             KKold=obj.KK;
0153             obj.sampling=[obj.sampling;obj.newSample];
0154             obj.requireRun=true;
0155             obj.requireIndices=true;
0156             KKnew=obj.buildMatrix();
0157             fA=all(all(KKold==KKnew));
0158             <span class="comment">%</span>
0159             f=(fS&amp;&amp;fE&amp;&amp;fA);
0160             <span class="comment">%</span>
0161             fprintf(<span class="string">'Matrix '</span>);
0162             <span class="keyword">if</span> f; fprintf(<span class="string">'OK'</span>); <span class="keyword">else</span>, fprintf(<span class="string">'NOK'</span>);<span class="keyword">end</span>
0163             fprintf(<span class="string">'\n'</span>);
0164             <span class="keyword">if</span> ~f;keyboard;<span class="keyword">end</span>
0165         <span class="keyword">end</span>
0166         <span class="comment">%load list Kernel functions</span>
0167         <a name="_sub12" href="#_subfunctions" class="code">function l=loadKern(obj)</a>
0168             l=obj.listKernel;
0169         <span class="keyword">end</span>
0170         <span class="comment">%new run required</span>
0171         <a name="_sub13" href="#_subfunctions" class="code">function fRun(obj);obj.requireRun=true;end</a>
0172         <span class="comment">%force gradients matrices computation</span>
0173         <a name="_sub14" href="#_subfunctions" class="code">function fGrad(obj);obj.forceGrad=true;end</a>
0174         <span class="comment">%force indices computation</span>
0175         <a name="_sub15" href="#_subfunctions" class="code">function fIX(obj);obj.requireIndices=true;end</a>
0176         <span class="comment">%compute number of required internal parameters</span>
0177         <a name="_sub16" href="#_subfunctions" class="code">function nbP=computeNbPara(obj)</a>
0178             <span class="keyword">switch</span> obj.fctKern
0179                 <span class="keyword">case</span> {<span class="string">'sexp'</span>,<span class="string">'matern32'</span>,<span class="string">'matern52'</span>}
0180                     nbP=unique([1,obj.nP]);
0181                 <span class="keyword">case</span> {<span class="string">'matern'</span>}
0182                     nbP=[1,obj.nP]+1;
0183             <span class="keyword">end</span>
0184         <span class="keyword">end</span>
0185         <span class="comment">%</span>
0186         <span class="comment">%manual getters for matrices</span>
0187         <a name="_sub17" href="#_subfunctions" class="code">function K=getKK(obj)</a>
0188             <span class="keyword">if</span> isempty(obj.KK)||obj.requireRun||obj.requireUpdate
0189                 K=obj.updateMatrix();
0190             <span class="keyword">else</span>
0191                 K=obj.KK;
0192             <span class="keyword">end</span>
0193         <span class="keyword">end</span>
0194         <a name="_sub18" href="#_subfunctions" class="code">function K=getKKd(obj)</a>
0195             obj.fGrad;
0196             obj.fIX;
0197             <span class="keyword">if</span> isempty(obj.KKd)||obj.requireRun||obj.requireUpdate
0198                 [~,K,~]=obj.updateMatrix();
0199             <span class="keyword">else</span>
0200                 K=obj.KKd;
0201             <span class="keyword">end</span>
0202         <span class="keyword">end</span>
0203         <a name="_sub19" href="#_subfunctions" class="code">function K=getKKdd(obj)</a>
0204             obj.fGrad;
0205             obj.fIX;
0206             <span class="keyword">if</span> isempty(obj.KKd)||obj.requireRun||obj.requireUpdate
0207                 [~,~,K]=obj.updateMatrix();
0208             <span class="keyword">else</span>
0209                 K=obj.KKdd;
0210             <span class="keyword">end</span>
0211         <span class="keyword">end</span>
0212         <span class="comment">%show the list of available kernel functions</span>
0213         <a name="_sub20" href="#_subfunctions" class="code">function showKernel(obj)</a>
0214             fprintf(<span class="string">'List of available kernel functions\n'</span>);
0215             <a href="#_sub23" class="code" title="subfunction dispTableTwoColumns(tableA,tableB)">dispTableTwoColumns</a>(obj.listKernel,obj.listKernelTxt)
0216         <span class="keyword">end</span>
0217     <span class="keyword">end</span>
0218 <span class="keyword">end</span>
0219 
0220 
0221 
0222 <span class="comment">%% function display table with two columns of text</span>
0223 <a name="_sub21" href="#_subfunctions" class="code">function dispTableTwoColumnsStruct(tableFieldIn,structIn)</a>
0224 <span class="comment">%size of every components in tableA</span>
0225 sizeA=cellfun(@numel,tableFieldIn);
0226 maxA=max(sizeA);
0227 <span class="comment">%space after each component</span>
0228 spaceA=maxA-sizeA+3;
0229 spaceTxt=<span class="string">' '</span>;
0230 <span class="comment">%display table</span>
0231 <span class="keyword">for</span> itT=1:numel(tableFieldIn)
0232     <span class="keyword">if</span> isfield(structIn,tableFieldIn{itT})
0233         fprintf(<span class="string">'%s%s%s\n'</span>,tableFieldIn{itT},spaceTxt(ones(1,spaceA(itT))),structIn.(tableFieldIn{itT}));
0234     <span class="keyword">end</span>
0235 <span class="keyword">end</span>
0236 <span class="keyword">end</span>
0237 
0238 <span class="comment">%% function display table with two columns of text</span>
0239 <a name="_sub22" href="#_subfunctions" class="code">function dispTableTwoColumns(tableA,tableB)</a>
0240 <span class="comment">%size of every components in tableA</span>
0241 sizeA=cellfun(@numel,tableA);
0242 maxA=max(sizeA);
0243 <span class="comment">%space after each component</span>
0244 spaceA=maxA-sizeA+3;
0245 spaceTxt=<span class="string">' '</span>;
0246 <span class="comment">%display table</span>
0247 <span class="keyword">for</span> itT=1:numel(tableA)
0248     fprintf(<span class="string">'%s%s%s\n'</span>,tableA{itT},spaceTxt(ones(1,spaceA(itT))),tableB{itT});
0249 <span class="keyword">end</span>
0250 <span class="keyword">end</span>
0251</pre></div>
<hr><address>Generated on Fri 18-Aug-2017 00:34:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>