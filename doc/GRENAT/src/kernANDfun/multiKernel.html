<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of multiKernel</title>
  <meta name="keywords" content="multiKernel">
  <meta name="description" content="% function for evaluating multidimensional kernel function">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # src --><!-- menu.html kernANDfun -->
<h1>multiKernel
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% function for evaluating multidimensional kernel function</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara,demoMod) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% function for evaluating multidimensional kernel function
 this function will call unidimensional kernel function (that give
 response, first and second derivatives)
 L. LAURENT -- 02/05/2016 -- luc.laurent@lecnam.net</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/src/libs/multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>	Matrix multiply each submatrix of two 3D arrays without looping.</li><li><a href="../../../GRENAT/src/libs/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>	MULTITRANSP  Transposing arrays of matrices.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/src/kernANDfun/@KernMatrix/buildMatrix.html" class="code" title="function [KK,KKd,KKdd]=buildMatrix(obj,paraV)">buildMatrix</a>	% Method of KernMatrix class</li><li><a href="../../../GRENAT/src/kernANDfun/@KernMatrix/buildVector.html" class="code" title="function [V,Vd,Vdd]=buildVector(obj,samplePts,paraV)">buildVector</a>	% Method of KernMatrix class</li><li><a href="../../../GRENAT/src/kernANDfun/@KernMatrix/updateMatrix.html" class="code" title="function [KK,KKd,KKdd]=updateMatrix(obj,newS)">updateMatrix</a>	% Method of KernMatrix class</li><li><a href="toolCheckKernelFct.html" class="code" title="">toolCheckKernelFct</a>	GRENAT - GRadient ENhanced Approximation Toolbox</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function paraV=initPara(kernelFun,Dim)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% function for evaluating multidimensional kernel function</span>
0002 <span class="comment">% this function will call unidimensional kernel function (that give</span>
0003 <span class="comment">% response, first and second derivatives)</span>
0004 <span class="comment">% L. LAURENT -- 02/05/2016 -- luc.laurent@lecnam.net</span>
0005 
0006 <span class="comment">% See Lockwood 2010 for an explanantion of U, L et M.</span>
0007 
0008 <a name="_sub0" href="#_subfunctions" class="code">function [respK,derK,dderK]=multiKernel(kernelFun,X,metaPara,demoMod)</a>
0009 
0010 
0011 <span class="comment">%number of output variables</span>
0012 nbOut=nargout;
0013 
0014 <span class="comment">%mode demo</span>
0015 demo=false;
0016 <span class="keyword">if</span> nargin==4;demo=demoMod;<span class="keyword">end</span>
0017 moddemo=1;
0018 <span class="keyword">if</span> nbOut==0
0019     <span class="keyword">if</span> moddemo==1
0020         nEDemo=300;
0021         X=linspace(-5,5,nEDemo);
0022         X=X';
0023         metaParaD=<a href="#_sub1" class="code" title="subfunction paraV=initPara(kernelFun,Dim)">initPara</a>(kernelFun,moddemo);
0024     <span class="keyword">elseif</span> moddemo==2
0025         nEDemo=50;
0026         X=linspace(-5,5,nEDemo);
0027         [XX,YY]=meshgrid(X);
0028         X=[XX(:) YY(:)];
0029         metaParaD=<a href="#_sub1" class="code" title="subfunction paraV=initPara(kernelFun,Dim)">initPara</a>(kernelFun,moddemo);
0030     <span class="keyword">end</span>
0031     <span class="keyword">if</span> nargin==1
0032         metaPara=metaParaD;
0033     <span class="keyword">end</span>
0034     demo=true;
0035     nbOut=3;
0036 <span class="keyword">end</span>
0037 
0038 <span class="comment">%number of required evaluations</span>
0039 nE=size(X,1);
0040 <span class="comment">%number of variables</span>
0041 nV=size(X,2);
0042 
0043 <span class="comment">%manage hyperparameters (depending in the kernel function)</span>
0044 nP=numel(metaPara);
0045 <span class="keyword">if</span> nP==1
0046     metaParaOk=metaPara*ones(nE*nV,1);
0047 <span class="keyword">elseif</span> nP==nV
0048     metaPara=metaPara(:)';
0049     metaParaOk=metaPara(ones(nE,1),:);
0050     metaParaOk=metaParaOk(:);
0051 <span class="keyword">elseif</span> nP==nV+1
0052     metaPara=metaPara(:)';
0053     metaParaA=metaPara(1:end-1);
0054     metaParaB=metaPara(end);
0055     metaParaAOk=metaParaA(ones(nE,1),:);
0056     metaParaBOk=metaParaB*ones(nE*nV,1);
0057     metaParaOk=[metaParaAOk(:) metaParaBOk(:)];
0058 <span class="keyword">elseif</span> nP==2*nV
0059     metaPara=metaPara(:)';
0060     metaParaA=metaPara(1:nV);
0061     metaParaB=metaPara(nV+1:end);
0062     metaParaAOk=metaParaA(ones(nE,1),:);
0063     metaParaBOk=metaParaB(ones(nE,1),:);
0064     metaParaOk=[metaParaAOk(:) metaParaBOk(:)];
0065 <span class="keyword">end</span>
0066 
0067 <span class="comment">%%depending on the output variables</span>
0068 <span class="comment">%calculation of the response</span>
0069 <span class="keyword">if</span> nbOut==1
0070     uniR=zeros(nE,nV);
0071     uniR(:)=feval(kernelFun,X(:),metaParaOk);
0072     <span class="comment">%response</span>
0073     respK=prod(uniR,2);
0074 <span class="keyword">end</span>
0075 <span class="comment">%calculation of the responses and first derivatives</span>
0076 <span class="keyword">if</span> nbOut==2
0077     uniR=zeros(nE,nV);
0078     duniR=zeros(nE,nV);
0079     [uniR(:),duniR(:)]=feval(kernelFun,X(:),metaParaOk);
0080     <span class="comment">%response</span>
0081     respK=prod(uniR,2);
0082     <span class="comment">%first derivatives</span>
0083     L=[ones(nE,1) cumprod(uniR(:,1:end-1),2)];
0084     U=cumprod(uniR(:,end:-1:2),2);
0085     U=[U(:,end:-1:1) ones(nE,1)];
0086     derK=L.*U.*duniR;
0087 <span class="keyword">end</span>
0088 
0089 <span class="comment">%calculation of the response and first and second derivatives</span>
0090 <span class="keyword">if</span> nbOut&gt;2
0091     uniR=zeros(nE,nV);
0092     duniR=zeros(nE,nV);
0093     dduniR=zeros(nE,nV);
0094     [uniR(:),duniR(:),dduniR(:)]=feval(kernelFun,X(:),metaParaOk);
0095     <span class="comment">%response</span>
0096     respK=prod(uniR,2);
0097     <span class="comment">%first derivatives</span>
0098     L=[ones(nE,1) cumprod(uniR(:,1:end-1),2)];
0099     U=cumprod(uniR(:,end:-1:2),2);
0100     U=[U(:,end:-1:1) ones(nE,1)];
0101     LdU=L.*U;
0102     derK=LdU.*duniR;
0103     <span class="comment">%second derivatives (depending of the number of required evaluations</span>
0104     <span class="keyword">if</span> nE==1
0105         <span class="comment">% if only 1 evaluation is required the seconde derivative is given</span>
0106         <span class="comment">% using a matrix</span>
0107         prd=duniR'*duniR;
0108         prd(1:nV+1:nV^2)=dduniR;
0109         <span class="comment">%</span>
0110         <span class="keyword">if</span> nV&gt;1;maskM=[1 1];<span class="keyword">else</span> maskM=1;<span class="keyword">end</span>
0111         mm=[maskM uniR(2:nV-1)];
0112         <span class="comment">%</span>
0113         M=mm(ones(nV,1),:);
0114         M=triu(M,2)+tril(ones(nV),1);
0115         M=cumprod(M,2);
0116         <span class="comment">%</span>
0117         LUMt=triu(L'*U.*M,1);
0118         LUM=LUMt+LUMt';
0119         LUM(1:nV+1:nV^2)=LdU;
0120         <span class="comment">%second derivatives</span>
0121         dderK=LUM.*prd;
0122     <span class="keyword">else</span>
0123         <span class="comment">% if many evaluation are required the second derivatives are given using an nD-array</span>
0124         ixDiag=repmat(logical(eye(nV)),[1 1 nE]); <span class="comment">%access to the diagonals of the nD-array</span>
0125         <span class="comment">%change to nD-array</span>
0126         duniR=reshape(duniR',1,nV,nE);
0127         Lr=reshape(L',nV,1,nE); <span class="comment">% + transpose</span>
0128         Ur=reshape(U',1,nV,nE);
0129         <span class="comment">%</span>
0130         prd=<a href="../../../GRENAT/src/libs/multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>(duniR,duniR,2.1);
0131         prd(ixDiag)=dduniR';
0132         <span class="keyword">if</span> nV&gt;1;maskM=[1 1];<span class="keyword">else</span> maskM=1;<span class="keyword">end</span>
0133         mm=[maskM 3:nV];
0134         mask1=mm(ones(nV,1),:); <span class="comment">%shift indexes</span>
0135         mask1=triu(mask1,2)+tril(ones(nV),1);
0136         pcc=reshape([ones(1,nE);uniR'],1,nV+1,nE);
0137         M=reshape(pcc(1,mask1,:),nV,nV,nE);
0138         <span class="comment">%</span>
0139         mask2=triu(ones(nV));
0140         M=cumprod(M,2);
0141         M=M.*repmat(mask2,[1 1 nE]);
0142         LUMt=<a href="../../../GRENAT/src/libs/multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>(Lr,Ur,2).*M;
0143         LUM=LUMt+<a href="../../../GRENAT/src/libs/multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(LUMt);        
0144         LUM(ixDiag)=LdU';
0145         <span class="comment">%second derivatives</span>
0146         dderK=LUM.*prd;
0147     <span class="keyword">end</span>
0148 <span class="keyword">end</span>
0149 
0150 <span class="comment">%figure en mode demo</span>
0151 <span class="keyword">if</span> demo
0152     figure
0153     <span class="keyword">if</span> moddemo==1
0154         plot(X,respK,<span class="string">'r'</span>,<span class="string">'LineWidth'</span>,2)
0155         hold on
0156         plot(X,derK,<span class="string">'b'</span>,<span class="string">'LineWidth'</span>,2)
0157         ddG=vertcat(dderK(:));
0158         plot(X,ddG,<span class="string">'k'</span>,<span class="string">'LineWidth'</span>,2)
0159         hold off
0160         ax = gca;
0161         ax.XAxisLocation = <span class="string">'origin'</span>;
0162         ax.YAxisLocation = <span class="string">'origin'</span>;
0163         legend(<span class="string">'h(r)'</span>,<span class="string">'f''(r)'</span>,<span class="string">'f''''(r)'</span>)
0164     <span class="keyword">elseif</span> moddemo==2
0165         subplot(231)
0166         Gp=zeros(nEDemo);
0167         Gp(:)=respK;
0168         surfc(XX,YY,Gp)
0169         title(<span class="string">'f(x,y)'</span>)
0170         subplot(232)
0171         Gp(:)=derK(:,1);
0172         surfc(XX,YY,Gp)
0173         title(<span class="string">'f''(x,y) (x)'</span>)
0174         subplot(233)
0175         Gp(:)=derK(:,2);
0176         surfc(XX,YY,Gp)
0177         title(<span class="string">'f''(x,y) (y)'</span>)
0178         subplot(234)
0179         Gp(:)=vertcat(dderK(1,1,:));
0180         surfc(XX,YY,Gp)
0181         title(<span class="string">'f''''(x,y) (x)'</span>)
0182         subplot(235)
0183         Gp(:)=vertcat(dderK(1,2,:));
0184         surfc(XX,YY,Gp)
0185         title(<span class="string">'f''''(x,y) (x,y)'</span>)
0186         subplot(236)
0187         Gp(:)=vertcat(dderK(2,2,:));
0188         surfc(XX,YY,Gp)
0189         title(<span class="string">'f''''(x,y) (y)'</span>)
0190     <span class="keyword">end</span>
0191 <span class="keyword">end</span>
0192 <span class="keyword">end</span>
0193 
0194 <span class="comment">%initialize hyperparameters for various kinds of kernel function</span>
0195 <a name="_sub1" href="#_subfunctions" class="code">function paraV=initPara(kernelFun,Dim)</a>
0196 paraInit=[1 0.9];
0197 <span class="keyword">switch</span> kernelFun
0198     <span class="keyword">case</span> <span class="string">'matern'</span>
0199         paraV=[paraInit paraInit(1:Dim)];
0200     <span class="keyword">otherwise</span>
0201         paraV=paraInit(1:Dim);
0202 <span class="keyword">end</span>
0203 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 02-Oct-2019 17:20:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>