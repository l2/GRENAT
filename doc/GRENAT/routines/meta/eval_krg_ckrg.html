<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of eval_krg_ckrg</title>
  <meta name="keywords" content="eval_krg_ckrg">
  <meta name="description" content="% Fonction assurant l'evaluation du metamodele de Krigeage ou de Cokrigeage">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # routines --><!-- menu.html meta -->
<h1>eval_krg_ckrg
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% Fonction assurant l'evaluation du metamodele de Krigeage ou de Cokrigeage</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [Z,GZ,variance,details]=eval_krg_ckrg(U,donnees,tir_part) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% Fonction assurant l'evaluation du metamodele de Krigeage ou de Cokrigeage
 L. LAURENT -- 15/12/2011 -- laurent@lmt.ens-cachan.fr</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>	% fonction assurant la normalisation/denormalisation des donnees</li><li><a href="../../../GRENAT/routines/divers/norm_denorm_g.html" class="code" title="function [out]=norm_denorm_g(in,type,infos)">norm_denorm_g</a>	% fonction assurant la normalisation/denormalisation des donnees de type gradients</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="cross_validate_krg_ckrg.html" class="code" title="function cv=cross_validate_krg_ckrg(data_block,meta,type)">cross_validate_krg_ckrg</a>	% Fonction assurant le calcul de diverses erreurs par validation croisee dans le cas du Krigeage/CoKrigeage</li><li><a href="eval_meta.html" class="code" title="function [Z]=eval_meta(points,donnees,meta,verb)">eval_meta</a>	% Evaluation du metamodele</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% Fonction assurant l'evaluation du metamodele de Krigeage ou de Cokrigeage</span>
0002 <span class="comment">% L. LAURENT -- 15/12/2011 -- laurent@lmt.ens-cachan.fr</span>
0003 
0004 <a name="_sub0" href="#_subfunctions" class="code">function [Z,GZ,variance,details]=eval_krg_ckrg(U,donnees,tir_part)</a>
0005 <span class="comment">% affichages warning ou non</span>
0006 aff_warning=false;
0007 <span class="comment">%Declaration des variables</span>
0008 nb_val=donnees.in.nb_val;
0009 nb_var=donnees.in.nb_var;
0010 
0011 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0012 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0013 <span class="comment">%calcul ou non des gradients (en fonction du nombre de variables de sortie)</span>
0014 <span class="keyword">if</span> nargout&gt;=2
0015     calc_grad=true;
0016 <span class="keyword">else</span>
0017     calc_grad=false;
0018 <span class="keyword">end</span>
0019 <span class="comment">% points de tirages particuliers</span>
0020 <span class="keyword">if</span> nargin==3
0021     tirages=tir_part;
0022 <span class="keyword">else</span>
0023     tirages=donnees.in.tiragesn;
0024 <span class="keyword">end</span>
0025 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0026 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0027 X=U;   
0028 dim_x=size(X,1);
0029 <span class="comment">%version vectoriel du code</span>
0030 vect_code=false;
0031 <span class="keyword">if</span> dim_x&gt;1;vect_code=true;<span class="keyword">end</span>
0032 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0033 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0034 <span class="comment">%normalisation</span>
0035 <span class="keyword">if</span> donnees.norm.on
0036     infos.moy=donnees.norm.moy_tirages;
0037     infos.std=donnees.norm.std_tirages;    
0038     X=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(X,<span class="string">'norm'</span>,infos);    
0039 <span class="keyword">end</span>
0040 
0041 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0042 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0043 <span class="comment">%calcul de l'evaluation du metamodele au point considere</span>
0044 <span class="comment">%definition des dimensions des matrices/vecteurs selon KRG et CKRG</span>
0045 <span class="keyword">if</span> donnees.in.pres_grad
0046     tail_matvec=nb_val*(nb_var+1);
0047 <span class="keyword">else</span>
0048     tail_matvec=nb_val;
0049 <span class="keyword">end</span>
0050 
0051 <span class="comment">%vecteur de correlation aux points d'evaluations et vecteur de correlation</span>
0052 <span class="comment">%derive</span>
0053 rr=zeros(tail_matvec,1);
0054 <span class="keyword">if</span> calc_grad
0055     jr=zeros(tail_matvec,nb_var);
0056 <span class="keyword">end</span>
0057 <span class="comment">%distance du point d'evaluation aux sites obtenus par DOE</span>
0058 dist=repmat(X,nb_val,dim_x)-tirages;
0059 
0060 <span class="comment">%KRG/CKRG</span>
0061 <span class="keyword">if</span> donnees.in.pres_grad
0062     <span class="keyword">if</span> calc_grad  <span class="comment">%si calcul des gradients</span>
0063         [ev,dev,ddev]=feval(donnees.build.corr,dist,donnees.build.para.val);
0064         rr(1:nb_val)=ev;
0065         rr(nb_val+1:tail_matvec)=-reshape(dev',1,nb_val*nb_var);
0066         
0067         <span class="comment">%derivee du vecteur de correlation aux points d'evaluations</span>
0068         jr(1:nb_val,:)=dev;  <span class="comment">% a debugger</span>
0069         
0070         <span class="comment">% derivees secondes</span>
0071         mat_der=zeros(nb_var,nb_var*nb_val);
0072         <span class="keyword">for</span> mm=1:nb_val
0073             mat_der(:,(mm-1)*nb_var+1:mm*nb_var)=ddev(:,:,mm);
0074         <span class="keyword">end</span>
0075         jr(nb_val+1:tail_matvec,:)=-mat_der';
0076         
0077         <span class="comment">%si donnees manquantes</span>
0078         <span class="keyword">if</span> donnees.manq.eval.on
0079             rr(donnees.manq.eval.ix_manq)=[];
0080             jr(donnees.manq.eval.ix_manq,:)=[];
0081         <span class="keyword">end</span>
0082         
0083         <span class="comment">%si donnees manquantes</span>
0084         <span class="keyword">if</span> donnees.manq.grad.on
0085             rep_ev=donnees.in.nb_val-donnees.manq.eval.nb;
0086             rr(rep_ev+donnees.manq.grad.ixt_manq_line)=[];
0087             jr(rep_ev+donnees.manq.grad.ixt_manq_line,:)=[];
0088         <span class="keyword">end</span>
0089         
0090     <span class="keyword">else</span> <span class="comment">%sinon</span>
0091         <span class="comment">%a reecrire //!!\\</span>
0092         [ev,dev]=feval(donnees.build.corr,dist,donnees.build.para.val);
0093         rr(1:nb_val)=ev;
0094         rr(nb_val+1:tail_matvec)=-reshape(dev',1,nb_val*nb_var);
0095         <span class="comment">%si donnees manquantes</span>
0096         <span class="keyword">if</span> donnees.manq.eval.on
0097             rr(donnees.manq.eval.ix_manq)=[];
0098             <span class="comment">%si donnees manquantes</span>
0099             <span class="keyword">if</span> donnees.manq.grad.on
0100                 rep_ev=donnees.in.nb_val-donnees.manq.eval.nb;
0101                 rr(rep_ev+donnees.manq.grad.ixt_manq_line)=[];
0102             <span class="keyword">end</span>
0103         <span class="keyword">end</span>
0104     <span class="keyword">end</span>
0105 <span class="keyword">else</span>
0106     <span class="keyword">if</span> calc_grad  <span class="comment">%si calcul des gradients</span>
0107         [rr,jr]=feval(donnees.build.corr,dist,donnees.build.para.val);
0108             <span class="keyword">else</span> <span class="comment">%sinon</span>
0109         rr=feval(donnees.build.corr,dist,donnees.build.para.val);
0110     <span class="keyword">end</span>
0111     <span class="comment">%si donnees manquantes</span>
0112     <span class="keyword">if</span> donnees.manq.eval.on
0113         rr(donnees.manq.eval.ix_manq)=[];
0114         jr(donnees.manq.eval.ix_manq,:)=[];
0115     <span class="keyword">end</span>
0116 <span class="keyword">end</span>
0117 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0118 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0119 <span class="comment">%matrice de regression aux points d'evaluations</span>
0120 <span class="keyword">if</span> calc_grad
0121     [ff,~,jf,~]=feval(donnees.build.fct_reg,X);
0122     jf=vertcat(jf{:});        
0123 <span class="keyword">else</span>
0124     ff=feval(donnees.build.fct_reg,X);
0125 <span class="keyword">end</span>
0126 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0127 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0128 <span class="comment">%evaluation du metamodele au point X</span>
0129 Z_reg=ff*donnees.build.beta;
0130 Z_sto=rr'*donnees.build.gamma;
0131 Z=Z_reg+Z_sto;
0132 <span class="keyword">if</span> calc_grad
0133     <span class="comment">%%verif en 2D+</span>
0134     GZ_reg=jf*donnees.build.beta;
0135     GZ_sto=jr'*donnees.build.gamma;
0136     GZ=GZ_reg+GZ_sto;
0137 <span class="keyword">end</span>
0138 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0139 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0140 <span class="comment">%calcul de la variance de prediction (MSE) (Lophaven, Nielsen &amp; Sondergaard</span>
0141 <span class="comment">%2004 / Marcelet 2008 / Chauvet 1999)</span>
0142 <span class="keyword">if</span> nargout &gt;=3
0143     <span class="keyword">if</span> ~aff_warning;warning off all;<span class="keyword">end</span>
0144     <span class="comment">%en fonction de la factorisation</span>
0145     <span class="keyword">switch</span> donnees.build.fact_rcc
0146         <span class="keyword">case</span> <span class="string">'QR'</span>
0147                         rrP=rr'*donnees.build.Prcc;
0148            Qrr=donnees.build.Qtrcc*rr;
0149             u=donnees.build.fcR*Qrr-ff';
0150             variance=donnees.build.sig2*(ones(dim_x,1)-(rrP/donnees.build.Rrcc)*Qrr+<span class="keyword">...</span>
0151                 u'/donnees.build.fcCfct*u);           
0152         <span class="keyword">case</span> <span class="string">'LU'</span>
0153             rrP=rr(donnees.build.Prcc,:);
0154             Lrr=donnees.build.Lrcc\rrP;
0155             u=donnees.build.fcU*Lrr-ff';
0156             variance=donnees.build.sig2*(ones(dim_x,1)-(rr'/donnees.build.Urcc)*Lrr+<span class="keyword">...</span>
0157                 u'/donnees.build.fcCfct*u);
0158         <span class="keyword">case</span> <span class="string">'LL'</span>
0159             Lrr=donnees.build.Lrcc\rr;
0160             u=donnees.build.fcL*Lrr-ff';
0161             variance=donnees.build.sig2*(ones(dim_x,1)-(rr'/donnees.build.Ltrcc)*Lrr+<span class="keyword">...</span>
0162                 u'/donnees.build.fcCfct*u);
0163         <span class="keyword">otherwise</span>
0164             rcrr=donnees.build.rcc \ rr;
0165             u=donnees.build.fc*rcrr-ff';
0166             variance=donnees.build.sig2*(ones(dim_x,1)+u'/donnees.build.fcCfct*u - rr'*rcrr);
0167     <span class="keyword">end</span>
0168     <span class="keyword">if</span> ~aff_warning;warning on all;<span class="keyword">end</span>
0169     
0170 <span class="keyword">end</span>
0171 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0172 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0173 <span class="comment">%normalisation</span>
0174 <span class="keyword">if</span> donnees.norm.on
0175     infos.moy=donnees.norm.moy_eval;
0176     infos.std=donnees.norm.std_eval;
0177     Z=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(Z,<span class="string">'denorm'</span>,infos);
0178     <span class="keyword">if</span> nargout==4        
0179         Z_reg=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(Z_reg,<span class="string">'denorm'</span>,infos);       
0180         Z_sto=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(Z_sto,<span class="string">'denorm'</span>,infos);
0181     <span class="keyword">end</span>
0182     <span class="keyword">if</span> calc_grad
0183         infos.std_e=donnees.norm.std_eval;
0184         infos.std_t=donnees.norm.std_tirages;
0185         GZ=<a href="../../../GRENAT/routines/divers/norm_denorm_g.html" class="code" title="function [out]=norm_denorm_g(in,type,infos)">norm_denorm_g</a>(GZ',<span class="string">'denorm'</span>,infos);
0186         GZ=GZ';
0187         <span class="keyword">if</span> nargout==4
0188             GZ_reg=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(GZ_reg',<span class="string">'denorm'</span>,infos)';
0189             GZ_sto=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(GZ_sto',<span class="string">'denorm'</span>,infos)';
0190         <span class="keyword">end</span>
0191         clear infos
0192     <span class="keyword">end</span>
0193 <span class="keyword">end</span>
0194 <span class="comment">%extraction details</span>
0195 <span class="keyword">if</span> nargout==4
0196     details.Z_reg=Z_reg;
0197     details.Z_sto=Z_sto;
0198     details.GZ_reg=GZ_reg;
0199     details.GZ_sto=GZ_sto;
0200 <span class="keyword">end</span>
0201 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 27-Aug-2015 11:57:14 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>