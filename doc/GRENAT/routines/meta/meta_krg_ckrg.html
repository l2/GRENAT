<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of meta_krg_ckrg</title>
  <meta name="keywords" content="meta_krg_ckrg">
  <meta name="description" content="% fonction de construction des metamodeles de Krigeage et de Cokrigeage">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # routines --><!-- menu.html meta -->
<h1>meta_krg_ckrg
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>% fonction de construction des metamodeles de Krigeage et de Cokrigeage</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [ret]=meta_krg_ckrg(tirages,eval,grad,meta,manq) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">% fonction de construction des metamodeles de Krigeage et de Cokrigeage
% L. LAURENT -- 12/12/2011 -- laurent@lmt.ens-cachan.fr</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../GRENAT/routines/divers/mergestruct.html" class="code" title="function sout = mergestruct(varargin)">mergestruct</a>	MERGESTRUCT Merge structures with unique fields.</li><li><a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>	% fonction assurant la normalisation/denormalisation des donnees</li><li><a href="../../../GRENAT/routines/divers/norm_denorm_g.html" class="code" title="function [out]=norm_denorm_g(in,type,infos)">norm_denorm_g</a>	% fonction assurant la normalisation/denormalisation des donnees de type gradients</li><li><a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>	% Construction des blocs du Krigeage</li><li><a href="cross_validate_krg_ckrg.html" class="code" title="function cv=cross_validate_krg_ckrg(data_block,meta,type)">cross_validate_krg_ckrg</a>	% Fonction assurant le calcul de diverses erreurs par validation croisee dans le cas du Krigeage/CoKrigeage</li><li><a href="estim_para_krg_ckrg.html" class="code" title="function para_estim=estim_para_krg_ckrg(donnees,meta)">estim_para_krg_ckrg</a>	% Fonction assurant l'estimation des parametres (longueur de correlation)</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="const_meta.html" class="code" title="function [ret]=const_meta(tirages,eval,grad_in,meta,num_fct)">const_meta</a>	% fonction assurant la construction du metamodele (pas son evaluation)</li><li><a href="meta_inkrg.html" class="code" title="function ret=meta_inkrg(tirages,eval,grad,meta,manq)">meta_inkrg</a>	% fonction assurant la construction du Krigeage a gradients indirect</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%% fonction de construction des metamodeles de Krigeage et de Cokrigeage</span>
0002 <span class="comment">%% L. LAURENT -- 12/12/2011 -- laurent@lmt.ens-cachan.fr</span>
0003 
0004 <a name="_sub0" href="#_subfunctions" class="code">function [ret]=meta_krg_ckrg(tirages,eval,grad,meta,manq)</a>
0005 
0006 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0007 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0008 <span class="comment">% Affichage des informations de construction</span>
0009 fprintf(<span class="string">' &gt;&gt; Construction : '</span>);
0010 <span class="keyword">if</span> ~isempty(grad);fprintf(<span class="string">'CoKrigeage \n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Krigeage \n'</span>);<span class="keyword">end</span>
0011 fprintf(<span class="string">'&gt;&gt; Deg : %i '</span>,meta.deg);
0012 <span class="keyword">if</span> meta.deg==0; fprintf(<span class="string">'(Ordinaire)\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'(Universel)\n'</span>);<span class="keyword">end</span>;
0013 fprintf(<span class="string">'&gt;&gt; Fonction de correlation: %s\n'</span>,meta.corr);
0014 fprintf(<span class="string">'&gt;&gt;&gt; CV: '</span>);<span class="keyword">if</span> meta.cv; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0015 fprintf(<span class="string">'&gt;&gt; Affichage CV: '</span>);<span class="keyword">if</span> meta.cv_aff; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0016 fprintf(<span class="string">'&gt;&gt; Correction conditionnement:'</span>);<span class="keyword">if</span> meta.recond; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0017 
0018 fprintf(<span class="string">'&gt;&gt;&gt; Estimation parametre: '</span>);<span class="keyword">if</span> meta.para.estim; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0019 <span class="keyword">if</span> meta.para.estim
0020     fprintf(<span class="string">'&gt;&gt; Algo estimation: %s\n'</span>,meta.para.method);
0021     fprintf(<span class="string">'&gt;&gt; Bornes recherche: [%d , %d]\n'</span>,meta.para.l_min,meta.para.l_max);
0022     <span class="keyword">switch</span> meta.corr
0023         <span class="keyword">case</span> {<span class="string">'corr_expg'</span>,<span class="string">'corr_expgg'</span>}
0024             fprintf(<span class="string">'&gt;&gt; Bornes recherche puissance: [%d , %d]\n'</span>,meta.para.p_min,meta.para.p_max);
0025     <span class="keyword">end</span>
0026     fprintf(<span class="string">'&gt;&gt; Anisotropie: '</span>);<span class="keyword">if</span> meta.para.aniso; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0027     fprintf(<span class="string">'&gt;&gt; Affichage estimation console: '</span>);<span class="keyword">if</span> meta.para.aff_iter_cmd; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0028     fprintf(<span class="string">'&gt;&gt; Affichage estimation graphique: '</span>);<span class="keyword">if</span> meta.para.aff_iter_graph; fprintf(<span class="string">'Oui\n'</span>);<span class="keyword">else</span> fprintf(<span class="string">'Non\n'</span>);<span class="keyword">end</span>
0029 <span class="keyword">else</span>
0030     fprintf(<span class="string">'&gt;&gt; Valeur parametre: %d\n'</span>,meta.para.l_val);
0031 <span class="keyword">end</span>
0032 fprintf(<span class="string">'&gt;&gt; Critere enrichissement actif:'</span>);
0033 <span class="keyword">if</span> meta.enrich.on;
0034     fprintf(<span class="string">'%s\n'</span>,<span class="string">'Oui'</span>);
0035     fprintf(<span class="string">'&gt;&gt; Ponderation WEI: '</span>)
0036     fprintf(<span class="string">'%d '</span>,meta.enrich.para_wei);
0037     fprintf(<span class="string">'\n'</span>)
0038     fprintf(<span class="string">'&gt;&gt; Ponderation GEI: '</span>)
0039     fprintf(<span class="string">'%d '</span>,meta.enrich.para_gei);
0040     fprintf(<span class="string">'\n'</span>)
0041     fprintf(<span class="string">'&gt;&gt; Ponderation LCB: %d\n'</span>,meta.enrich.para_lcb);
0042 <span class="keyword">else</span>
0043     fprintf(<span class="string">'%s\n'</span>,<span class="string">'non'</span>);
0044 <span class="keyword">end</span>
0045 
0046 fprintf(<span class="string">'\n'</span>)
0047 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0048 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0049 
0050 <span class="comment">%chargement variables globales</span>
0051 <span class="keyword">global</span> aff
0052 
0053 <span class="comment">%initialisation tempo</span>
0054 tic;
0055 tps_start=toc;
0056 
0057 <span class="comment">%initialisation des variables</span>
0058 <span class="comment">%nombre d'evalutions</span>
0059 nb_val=size(eval,1);
0060 <span class="comment">%dimension du pb (nb de variables de conception)</span>
0061 nb_var=size(tirages,2);
0062 
0063 <span class="comment">%test presence des gradients</span>
0064 pres_grad=~isempty(grad);
0065 
0066 <span class="comment">%test donnees manquantes</span>
0067 manq_eval=false;
0068 manq_grad=false;
0069 <span class="keyword">if</span> nargin==5
0070     manq_eval=manq.eval.on;
0071     manq_grad=manq.grad.on;
0072     pres_grad=(~manq.grad.all&amp;&amp;manq.grad.on)||(pres_grad&amp;&amp;~manq.grad.on);
0073 <span class="keyword">else</span>
0074     manq=[];
0075     manq.eval.on=false;
0076     manq.grad.on=false;
0077 <span class="keyword">end</span>
0078 
0079 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0080 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0081 <span class="comment">%Normalisation</span>
0082 <span class="keyword">if</span> meta.norm
0083     <span class="comment">%normalisation des donnees</span>
0084     [evaln,infos_e]=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(eval,<span class="string">'norm'</span>,manq);
0085     [tiragesn,infos_t]=<a href="../../../GRENAT/routines/divers/norm_denorm.html" class="code" title="function [out,infos]=norm_denorm(in,type,infos)">norm_denorm</a>(tirages,<span class="string">'norm'</span>);
0086     std_e=infos_e.std;moy_e=infos_e.moy;
0087     std_t=infos_t.std;moy_t=infos_t.moy;
0088     
0089     <span class="comment">%normalisation des gradients</span>
0090     <span class="keyword">if</span> pres_grad
0091         infos.std_e=infos_e.std;infos.moy_e=infos_e.moy;
0092         infos.std_t=infos_t.std;infos.moy_t=infos_t.moy;
0093         gradn=<a href="../../../GRENAT/routines/divers/norm_denorm_g.html" class="code" title="function [out]=norm_denorm_g(in,type,infos)">norm_denorm_g</a>(grad,<span class="string">'norm'</span>,infos); clear infos
0094     <span class="keyword">else</span>
0095         gradn=[];
0096     <span class="keyword">end</span>
0097     
0098     <span class="comment">%sauvegarde des calculs</span>
0099     nkrg.norm.moy_eval=infos_e.moy;
0100     nkrg.norm.std_eval=infos_e.std;
0101     nkrg.norm.moy_tirages=infos_t.moy;
0102     nkrg.norm.std_tirages=infos_t.std;
0103     nkrg.norm.on=true;
0104     clear infos_e infos_t
0105 <span class="keyword">else</span>
0106     nkrg.norm.on=false;
0107     nkrg.norm.moy_eval=[];
0108     nkrg.norm.std_eval=[];
0109     nkrg.norm.moy_tirages=[];
0110     nkrg.norm.std_tirages=[];
0111     nkrg.norm.on=false;
0112     evaln=eval;
0113     tiragesn=tirages;
0114     <span class="keyword">if</span> pres_grad
0115         gradn=grad;
0116     <span class="keyword">else</span>
0117         gradn=[];
0118     <span class="keyword">end</span>
0119 <span class="keyword">end</span>
0120 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0121 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0122 <span class="comment">%evaluations et gradients aux points echantillonnes</span>
0123 y=evaln;
0124 <span class="comment">%suppression reponse(s) manquantes</span>
0125 <span class="keyword">if</span> manq_eval
0126     y=y(manq.eval.ix_dispo);
0127 <span class="keyword">end</span>
0128 
0129 <span class="keyword">if</span> pres_grad
0130     tmp=gradn';
0131     der=tmp(:);
0132     <span class="comment">%supression gradient(s) manquant(s)</span>
0133     <span class="keyword">if</span> manq_grad
0134         der=der(manq.grad.ixt_dispo_line);
0135     <span class="keyword">end</span>
0136     y=vertcat(y,der);
0137 <span class="keyword">end</span>
0138 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0139 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0140 <span class="comment">% construction systeme d'indices pour la construction de la matrice de</span>
0141 <span class="comment">% krigeage/cokrigeage</span>
0142 <span class="keyword">if</span> pres_grad
0143     
0144     taille_matRc=(nb_val^2+nb_val)/2;
0145     taille_matRa=nb_var*(nb_val^2+nb_val)/2;
0146     taille_matRi=nb_var^2*(nb_val^2+nb_val)/2;
0147     ind_matrix=zeros(taille_matRc,1);
0148     ind_matrixA=zeros(taille_matRa,1);
0149     ind_matrixAb=zeros(taille_matRa,1);
0150     ind_matrixI=zeros(taille_matRi,1);
0151     ind_dev=zeros(taille_matRa,1);
0152     ind_pts=zeros(taille_matRc,2);
0153     
0154     liste_tmp=zeros(taille_matRc,nb_var);
0155     liste_tmp(:)=1:taille_matRc*nb_var;
0156     
0157     ite=0;
0158     iteA=0;
0159     iteAb=0;
0160     pres=0;
0161     <span class="comment">%table indices pour les inter-distances (1), les reponses (1) et les</span>
0162     <span class="comment">%derivees 1ere (2)</span>
0163     <span class="keyword">for</span> ii=1:nb_val
0164         
0165         ite=ite(end)+(1:(nb_val-ii+1));
0166         ind_matrix(ite)=(nb_val+1)*ii-nb_val:ii*nb_val;
0167         ind_pts(ite,:)=[ii(ones(nb_val-ii+1,1)) (ii:nb_val)'];        
0168         iteAb=iteAb(end)+(1:((nb_val-ii+1)*nb_var));
0169         
0170         debb=(ii-1)*nb_var*nb_val+ii;
0171         finb=nb_val^2*nb_var-(nb_val-ii);
0172         lib=debb:nb_val:finb;
0173         
0174         ind_matrixAb(iteAb)=lib;
0175 
0176         <span class="keyword">for</span> jj=1:nb_var
0177             iteA=iteA(end)+(1:(nb_val-ii+1));
0178             decal=(ii-1);
0179             deb=pres+decal;
0180             li=deb + (1:(nb_val-ii+1));
0181             ind_matrixA(iteA)=li;
0182             pres=li(end);
0183             liste_tmpB=reshape(liste_tmp',[],1);
0184             ind_dev(iteA)=liste_tmp(ite,jj);
0185             ind_devb=liste_tmpB; 
0186         <span class="keyword">end</span>
0187     <span class="keyword">end</span>
0188     <span class="comment">%table indices derivees secondes</span>
0189     a=zeros(nb_val*nb_var,nb_var);
0190     decal=0;
0191     precI=0;
0192     iteI=0;
0193     <span class="keyword">for</span> ii=1:nb_val
0194         li=1:nb_val*nb_var^2;
0195         a(:)=decal+li;
0196         decal=a(end);
0197         b=a';
0198         
0199         iteI=precI+(1:(nb_var^2*(nb_val-(ii-1))));
0200         
0201         debb=(ii-1)*nb_var^2+1;
0202         finb=nb_var^2*nb_val;
0203         iteb=debb:finb;
0204         ind_matrixI(iteI)=b(iteb);
0205         precI=iteI(end);
0206     <span class="keyword">end</span>
0207 <span class="keyword">else</span>
0208     <span class="comment">%table indices pour les inter-distances (1), les reponses (1)</span>
0209     bmax=nb_val-1;
0210     ind_matrix=zeros(nb_val*(nb_val-1)/2,1);
0211     ind_pts=zeros(nb_val*(nb_val-1)/2,2);
0212     ite=0;
0213     <span class="keyword">for</span> ii=1:bmax
0214         ite=ite(end)+(1:(nb_val-ii));
0215         ind_matrix(ite)=(nb_val+1)*ii-nb_val+1:ii*nb_val;
0216         ind_pts(ite,:)=[ii(ones(nb_val-ii,1)) (ii+1:nb_val)'];
0217     <span class="keyword">end</span>
0218 <span class="keyword">end</span>
0219 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0220 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0221 <span class="comment">%calcul distances inter-sites</span>
0222 dist=tiragesn(ind_pts(:,1),:)-tiragesn(ind_pts(:,2),:);
0223 
0224 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0225 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0226 <span class="comment">%creation matrice de conception</span>
0227 <span class="comment">%(regression polynomiale)</span>
0228 <span class="comment">%autre fonction de calcul des regresseur reg_poly0,1 ou 2</span>
0229 fct_reg=[<span class="string">'mono_'</span> num2str(meta.deg,<span class="string">'%02i'</span>) <span class="string">'_'</span> num2str(nb_var,<span class="string">'%03i'</span>)];
0230 
0231 <span class="comment">%/!\ en le cokrigeage universel n'est pas operationnel</span>
0232 <span class="comment">%if pres_grad&amp;&amp;meta.deg~=0</span>
0233 <span class="comment">%   meta.deg=0;nb_termes=1;</span>
0234 <span class="comment">%   fprintf('Le Cokrigeage Universel n''est pas operationnel (on construit un Cokrigeage Ordinaire)\n')</span>
0235 <span class="comment">%end</span>
0236 
0237 <span class="keyword">if</span> ~pres_grad
0238     fct=feval(fct_reg,tiragesn);
0239     <span class="keyword">if</span> manq_eval
0240         <span class="comment">%suppression valeur(s) aux sites a reponse(s) manquante(s)</span>
0241         fct=fct(manq.eval.ix_dispo,:);
0242     <span class="keyword">end</span>
0243 <span class="keyword">else</span>
0244     [Reg,nb_termes,DReg,~]=feval(fct_reg,tiragesn);
0245     <span class="keyword">if</span> manq_eval||manq_grad
0246         taille_ev=nb_val-manq.eval.nb;
0247         taille_gr=nb_val*nb_var-manq.grad.nb;
0248         taille_tot=taille_ev+taille_gr;
0249     <span class="keyword">else</span>
0250         taille_ev=nb_val;
0251         taille_gr=nb_val*nb_var;
0252         taille_tot=taille_ev+taille_gr;
0253     <span class="keyword">end</span>
0254     <span class="comment">%initialisation matrice des regresseurs</span>
0255     fct=zeros(taille_tot,nb_termes);
0256     <span class="keyword">if</span> manq_eval
0257         <span class="comment">%suppression valeur(s) aux site a reponse(s) manquante(s)</span>
0258         Reg=Reg(manq.eval.ix_dispo,:);
0259     <span class="keyword">end</span>
0260     <span class="comment">%chargement regresseur (evaluation de monomes)</span>
0261     fct(1:taille_ev,:)=Reg;
0262     <span class="comment">%chargement des derivees des regresseurs (evaluation des derivees des monomes)</span>
0263     <span class="keyword">if</span> iscell(DReg)
0264         tmp=horzcat(DReg{:})';
0265         tmp=reshape(tmp,nb_termes,[])';
0266     <span class="keyword">else</span>
0267         tmp=DReg';
0268         tmp=tmp(:);
0269     <span class="keyword">end</span>
0270     
0271     <span class="keyword">if</span> manq_grad
0272         <span class="comment">%suppression valeur(s) aux sites a gradient(s) manquant(s)</span>
0273         tmp=tmp(manq.grad.ixt_dispo_line,:);
0274     <span class="keyword">end</span>
0275     <span class="comment">%chargement derivees regresseur</span>
0276     fct(taille_ev+1:<span class="keyword">end</span>,:)=tmp;
0277 <span class="keyword">end</span>
0278 
0279 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0280 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0281 <span class="comment">%stockage des grandeurs</span>
0282 ret.in.tirages=tirages;
0283 ret.in.tiragesn=tiragesn;
0284 ret.in.dist=dist;
0285 ret.in.eval=eval;
0286 ret.in.evaln=evaln;
0287 ret.in.pres_grad=pres_grad;
0288 ret.in.grad=grad;
0289 ret.in.gradn=gradn;
0290 ret.in.nb_var=nb_var;
0291 ret.in.nb_val=nb_val;
0292 ret.ind.matrix=ind_matrix;
0293 ret.ind.pts=ind_pts;
0294 <span class="keyword">if</span> pres_grad
0295     ret.ind.matrixA=ind_matrixA;
0296     ret.ind.matrixAb=ind_matrixAb;
0297     ret.ind.matrixI=ind_matrixI;
0298     ret.ind.dev=ind_dev;
0299     ret.ind.devb=ind_devb;
0300 <span class="keyword">end</span>
0301 ret.norm=nkrg.norm;
0302 ret.build.fct=fct;
0303 ret.build.fc=fct';
0304 ret.build.dim_fc=size(fct,2);
0305 ret.build.y=y;
0306 ret.build.fct_reg=fct_reg;
0307 ret.build.corr=meta.corr;
0308 ret.manq=manq;
0309 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0310 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0311 <span class="comment">%Calcul de la log-vraisemblance dans le cas  de l'estimation des parametres</span>
0312 <span class="comment">%(si on saouhaite avoir les valeurs de la log-vraisemblance en fonction des</span>
0313 <span class="comment">%parametres)</span>
0314 <span class="keyword">if</span> meta.para.estim&amp;&amp;meta.para.aff_estim
0315     val_para=linspace(meta.para.l_min,meta.para.l_max,30);
0316     <span class="comment">%dans le cas ou on considere de l'anisotropie (et si on a 2</span>
0317     <span class="comment">%variable de conception)</span>
0318     <span class="keyword">if</span> meta.para.aniso&amp;&amp;nb_var==2
0319         <span class="comment">%on genere la grille d'�tude</span>
0320         [val_X,val_Y]=meshgrid(val_para,val_para);
0321         <span class="comment">%initialisation matrice de stockage des valeurs de la</span>
0322         <span class="comment">%log-vraisemblance</span>
0323         val_lik=zeros(size(val_X));
0324         <span class="keyword">for</span> itli=1:numel(val_X)
0325             <span class="comment">%calcul de la log-vraisemblance et stockage</span>
0326             val_lik(itli)=<a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>(ret,meta,[val_X(itli) val_Y(itli)]);
0327             <span class="comment">%aff_avance(itli,numel(val_X));</span>
0328         <span class="keyword">end</span>
0329         <span class="comment">%trace log-vraisemblance</span>
0330         figure;
0331         [C,h]=contourf(val_X,val_Y,val_lik);
0332         text_handle = clabel(C,h);
0333         set(text_handle,<span class="string">'BackgroundColor'</span>,[1 1 .6],<span class="keyword">...</span>
0334             <span class="string">'Edgecolor'</span>,[.7 .7 .7])
0335         set(h,<span class="string">'LineWidth'</span>,2)
0336         <span class="comment">%stockage de la figure au format LaTeX/TikZ</span>
0337         <span class="keyword">if</span> meta.save
0338             matlab2tikz([aff.doss <span class="string">'/logli.tex'</span>])
0339         <span class="keyword">end</span>
0340         
0341     <span class="keyword">elseif</span> ~meta.para.aniso||nb_var==1
0342         <span class="comment">%initialisation matrice de stockage des &quot;valeurs de la</span>
0343         <span class="comment">%log-vraisemblance</span>
0344         val_lik=zeros(1,length(val_para));
0345         <span class="keyword">for</span> itli=1:length(val_para)
0346             <span class="comment">%calcul de la log-vraisemblance et stockage</span>
0347             val_lik(itli)=<a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>(ret,meta,val_para(itli));
0348         <span class="keyword">end</span>
0349         
0350         <span class="comment">%stockage log-vraisemblance dans un fichier .dat</span>
0351         <span class="keyword">if</span> meta.save
0352             ss=[val_para' val_lik'];
0353             save([aff.doss <span class="string">'/logli.dat'</span>],<span class="string">'ss'</span>,<span class="string">'-ascii'</span>);
0354         <span class="keyword">end</span>
0355         
0356         <span class="comment">%trace log-vraisemblance</span>
0357         figure;
0358         plot(val_para,val_lik);
0359         title(<span class="string">'Evolution de la log-vraisemblance'</span>);
0360     <span class="keyword">end</span>
0361     
0362     <span class="comment">%stocke les courbes (si actif)</span>
0363     <span class="keyword">if</span> aff.save&amp;&amp;(nbv&lt;=2)
0364         fich=save_aff(<span class="string">'fig_likelihood'</span>,aff.doss);
0365         <span class="keyword">if</span> aff.tex
0366             fid=fopen([aff.doss <span class="string">'/fig.tex'</span>],<span class="string">'a+'</span>);
0367             fprintf(fid,<span class="string">'\\figcen{%2.1f}{../%s}{%s}{%s}\n'</span>,0.7,fich,<span class="string">'Vraisemblance'</span>,fich);
0368             <span class="comment">%fprintf(fid,'\\verb{%s}\n',fich);</span>
0369             fclose(fid);
0370         <span class="keyword">end</span>
0371     <span class="keyword">end</span>
0372 <span class="keyword">end</span>
0373 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0374 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0375 <span class="comment">%%Construction des differents elements avec ou sans estimation des</span>
0376 <span class="comment">%%parametres</span>
0377 <span class="keyword">if</span> meta.para.estim
0378     para_estim=<a href="estim_para_krg_ckrg.html" class="code" title="function para_estim=estim_para_krg_ckrg(donnees,meta)">estim_para_krg_ckrg</a>(ret,meta);
0379     ret.build.para_estim=para_estim;
0380     meta.para.l_val=para_estim.l_val;
0381     meta.para.val=para_estim.l_val;
0382     <span class="keyword">if</span> isfield(para_estim,<span class="string">'p_val'</span>)
0383         meta.para.p_val=para_estim.p_val;
0384         meta.para.val=[meta.para.val meta.para.p_val];
0385     <span class="keyword">end</span>
0386 <span class="keyword">else</span>
0387     <span class="keyword">switch</span> meta.corr
0388         <span class="keyword">case</span> {<span class="string">'corr_expg'</span>,<span class="string">'corr_expgg'</span>}
0389             meta.para.val=[meta.para.l_val meta.para.p_val];
0390         <span class="keyword">otherwise</span>
0391             meta.para.val=meta.para.l_val;
0392     <span class="keyword">end</span>
0393 <span class="keyword">end</span>
0394 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0395 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0396 <span class="comment">%construction des blocs de krigeage finaux tenant compte des longueurs de</span>
0397 <span class="comment">%correlation obtenues par minimisation</span>
0398 [lilog,block]=<a href="bloc_krg_ckrg.html" class="code" title="function [lilog,ret]=bloc_krg_ckrg(donnees,meta,para)">bloc_krg_ckrg</a>(ret,meta);
0399 
0400 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0401 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0402 <span class="comment">%sauvegarde informations</span>
0403 tmp=<a href="../../../GRENAT/routines/divers/mergestruct.html" class="code" title="function sout = mergestruct(varargin)">mergestruct</a>(ret.build,block.build);
0404 ret.build=tmp;
0405 ret.build.lilog=lilog;
0406 ret.build.para=meta.para;
0407 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0408 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0409 tps_stop=toc;
0410 ret.tps=tps_stop-tps_start;
0411 <span class="keyword">if</span> pres_grad;txt=<span class="string">'CoKrigeage'</span>;<span class="keyword">else</span> txt=<span class="string">'Krigeage'</span>;<span class="keyword">end</span>
0412 fprintf(<span class="string">'\nExecution construction %s: %6.4d s\n\n'</span>,txt,tps_stop-tps_start);
0413 
0414 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0415 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0416 <span class="comment">%%%%%Validation croisee</span>
0417 <span class="comment">%%%%%Calcul des differentes erreurs</span>
0418 <span class="keyword">if</span> meta.cv
0419     id=tic;
0420     [ret.cv]=<a href="cross_validate_krg_ckrg.html" class="code" title="function cv=cross_validate_krg_ckrg(data_block,meta,type)">cross_validate_krg_ckrg</a>(ret,meta);
0421     
0422     tps_cv=toc(id);
0423     fprintf(<span class="string">'Execution validation croisee %s: %6.4d s\n\n'</span>,txt,tps_cv);
0424 <span class="keyword">end</span>
0425 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0426 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0427 <span class="keyword">end</span>
0428</pre></div>
<hr><address>Generated on Fri 07-Feb-2014 20:13:17 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>