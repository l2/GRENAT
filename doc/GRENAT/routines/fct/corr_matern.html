<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of corr_matern</title>
  <meta name="keywords" content="corr_matern">
  <meta name="description" content="%fonction de correlation Matern">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html GRENAT --><!-- # routines --><!-- menu.html fct -->
<h1>corr_matern
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>%fonction de correlation Matern</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [corr,dcorr,ddcorr]=corr_matern(xx,para) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">%fonction de correlation Matern 
%L. LAURENT -- 06/02/2013 -- luc.laurent@ens-cachan.fr</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>	Matrix multiply each submatrix of two 3D arrays without looping.</li><li><a href="multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>	MULTITRANSP  Transposing arrays of matrices.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%%fonction de correlation Matern</span>
0002 <span class="comment">%%L. LAURENT -- 06/02/2013 -- luc.laurent@ens-cachan.fr</span>
0003 
0004 <span class="comment">%parametres possibles nd+1 (nd: portees et 1: regularite</span>
0005 
0006 <a name="_sub0" href="#_subfunctions" class="code">function [corr,dcorr,ddcorr]=corr_matern(xx,para)</a>
0007 
0008 <span class="comment">%nombre de points a evaluer</span>
0009 nb_pt=size(xx,1);
0010 <span class="comment">%nombre de composantes</span>
0011 nb_comp=size(xx,2);
0012 <span class="comment">%nombre de sorties</span>
0013 nb_out=nargout;
0014 <span class="comment">%verification de la dimension de la longueur de correlations</span>
0015 lt=numel(para);
0016 <span class="keyword">if</span> lt~=2||lt~=nb_comp+1
0017     error(<span class="string">'Mauvais nombre de parametres corr_matern'</span>);
0018 <span class="keyword">end</span>
0019 <span class="comment">%regularite</span>
0020 nu=para(1);
0021 <span class="comment">%portees</span>
0022 long=para(2:end);
0023 <span class="comment">%La longueur de correlation est definie pour toutes les composantes de xx</span>
0024 <span class="keyword">if</span> lt-1==1
0025     long = long*ones(nb_pt,nb_comp);
0026 <span class="keyword">elseif</span> lt-1==nb_comp
0027     long = long(ones(nb_pt,1),:);
0028 <span class="keyword">end</span>
0029 
0030 <span class="comment">%calcul de la valeur de la fonction au point xx</span>
0031 coef_m=2*nu^.5./long;
0032 coef_s=nu./2^(nu-1)*gamma(nu);
0033 xx_n=abs(xx)./long;
0034 xx_pn=abs(xx).^(-nu);
0035 <span class="comment">%on s'assure que l'on peut bien faire le calcul (pb en zero)</span>
0036 II=xx_pn&lt;1e50;
0037 pc=ones(nb_pt,nb_comp);
0038 bess_nu=besselmx(double(<span class="string">'K'</span>),nu,xx_n,0);
0039 pc(II)=coef_m(II).^nu.*coef_s./xx_pn(II).*bess_nu(II);
0040 
0041 <span class="comment">%nouvelle implementation issue de Lockwood 2010/2012</span>
0042 <span class="comment">%calcul derivees premieres et seconde selon chaque dimension puis</span>
0043 <span class="comment">%combinaison</span>
0044 <span class="keyword">if</span> nb_out==1
0045     corr=prod(pc,2);
0046 <span class="keyword">elseif</span> nb_out==2
0047     <span class="comment">%reponse</span>
0048     corr=prod(pc,2);
0049     <span class="comment">%calcul derivees premieres</span>
0050     dk=zeros(nb_pt,nb_comp);
0051     dk(II)=-coef_s.*coef_m(II).^(nu+1)./xx_pn(II).*<span class="keyword">...</span>
0052         besselmx(double(<span class="string">'K'</span>),nu-1,xx_n(II),0).*sign(xx(II));
0053     L=[ones(nb_pt,1) cumprod(pc(:,1:end-1),2)];
0054     U=cumprod(pc(:,end:-1:2),2);U=[U(:,end:-1:1) ones(nb_pt,1)];
0055     dcorr=L.*U.*dk;
0056 
0057 <span class="keyword">elseif</span> nb_out==3
0058     <span class="comment">%reponse</span>
0059     corr=prod(pc,2);
0060     <span class="comment">%calcul derivees premieres</span>
0061     bess_num=besselmx(double(<span class="string">'K'</span>),nu-1,xx_n,0);
0062     dk=zeros(nb_pt,nb_comp);
0063     dk(II)=-coef_s.*coef_m(II).^(nu+1)./xx_pn(II).*<span class="keyword">...</span>
0064         bess_num(II).*sign(xx(II));
0065   <span class="comment">% signification U et L cf. Lockwood 2010</span>
0066     L=[ones(nb_pt,1) cumprod(pc(:,1:end-1),2)];
0067     U=cumprod(pc(:,end:-1:2),2);U=[U(:,end:-1:1) ones(nb_pt,1)];
0068     LdU=L.*U;
0069     <span class="comment">%derivees premieres</span>
0070     dcorr=LdU.*dk;
0071 
0072     <span class="comment">%calcul derivees secondes</span>
0073     <span class="comment">%suivant la taille de l'evaluation demandee on stocke les derivees</span>
0074     <span class="comment">%secondes de manieres differentes</span>
0075     ddk=-coef_s.*coef_m.^(nu+1).*(abs(xx).^(nu-1).*bess_num-<span class="keyword">...</span>
0076         coef_m.*abs(xx).^nu.*besselmx(double(<span class="string">'K'</span>),nu-2,xx_n,0));
0077     
0078     -coef_s.*coef_m.^(nu+1).*(1-coef_m)
0079     
0080     <span class="keyword">if</span> nb_pt==1
0081         <span class="comment">% si un seul point d'evaluation (sortie derivees secondes sous la</span>
0082         <span class="comment">% forme d'une matrice)</span>
0083         <span class="comment">% signification U, L et M cf. Lockwood 2010</span>
0084         prd=dk'*dk;
0085         prd(1:nb_comp+1:nb_comp^2)=ddk;
0086         <span class="comment">%</span>
0087         <span class="comment">%pc=[1 pc]; %correction pc pour prise en compte dimension 1</span>
0088         <span class="keyword">if</span> nb_comp&gt;1;motif=[1 1];<span class="keyword">else</span> motif=1;<span class="keyword">end</span>
0089         mm=[motif pc(2:nb_comp-1)];
0090         
0091         M=mm(ones(nb_comp,1),:);
0092         M=triu(M,2)+tril(ones(nb_comp),1);
0093         M=cumprod(M,2);
0094         <span class="comment">%</span>
0095         LUMt=triu(L'*U.*M,1);
0096         LUM=LUMt+LUMt';
0097         LUM(1:nb_comp+1:nb_comp^2)=LdU;
0098         <span class="comment">%derivees secondes</span>
0099         ddcorr=LUM.*prd;
0100     <span class="keyword">else</span>
0101         <span class="comment">% si plusieurs points alors on stocke les derivees secondes dans un</span>
0102         <span class="comment">% vecteur de matrices</span>
0103         IX_diag=repmat(logical(eye(nb_comp)),[1 1 nb_pt]); <span class="comment">%acces diatgonales des N-D array</span>
0104         <span class="comment">%passage grandeur en ND-array</span>
0105         dk=reshape(dk',1,nb_comp,nb_pt);
0106         Lr=reshape(L',nb_comp,1,nb_pt); <span class="comment">% + transpose</span>
0107         Ur=reshape(U',1,nb_comp,nb_pt);
0108         <span class="comment">%</span>
0109         prd=<a href="multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>(dk,dk,2.1);
0110         prd(IX_diag)=ddk';
0111         <span class="keyword">if</span> nb_comp&gt;1;motif=[1 1];<span class="keyword">else</span> motif=1;<span class="keyword">end</span>
0112         mm=[motif 3:nb_comp];
0113         masq1=mm(ones(nb_comp,1),:); <span class="comment">%decalage indice pour cause decalage ds pc</span>
0114         masq1=triu(masq1,2)+tril(ones(nb_comp),1);
0115         <span class="comment">%</span>
0116         pcc=reshape([ones(1,nb_pt);pc'],1,nb_comp+1,nb_pt);
0117         M=reshape(pcc(1,masq1,:),nb_comp,nb_comp,nb_pt);
0118         <span class="comment">%</span>
0119         masq2=triu(ones(nb_comp));
0120         M=cumprod(M,2);
0121         M=M.*repmat(masq2,[1 1 nb_pt]);
0122         LUMt=<a href="multiTimes.html" class="code" title="function C = multiTimes( A, B, type )">multiTimes</a>(Lr,Ur,2).*M;
0123         LUM=LUMt+<a href="multitransp.html" class="code" title="function b = multitransp(a, dim)">multitransp</a>(LUMt);        
0124         LUM(IX_diag)=LdU';
0125         <span class="comment">%derivees secondes</span>
0126         ddcorr=LUM.*prd;
0127     <span class="keyword">end</span>
0128 
0129 
0130 <span class="keyword">else</span>
0131     error(<span class="string">'Mauvais argument de sortie de la fonction corr_matern32'</span>);
0132 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Thu 27-Aug-2015 11:57:14 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>